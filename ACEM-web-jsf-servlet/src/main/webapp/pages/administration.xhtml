<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:e="http://commons.esup-portail.org"
	template="../templates/template.xhtml">
	<ui:define name="content">
		<ui:debug hotkey="1"
			rendered="#{facesContext.application.projectStage == 'Development'}" />

		<h:form id="formOrganisations" enctype="multipart/form-data">
			<p:growl id="messagesDisplayerFormOrganisations" showDetail="true" />

			<p:confirmDialog global="true" showEffect="fade">
				<p:commandButton value="#{msgs['CONFIRM_DIALOG.YES_LABEL']}"
					type="button" styleClass="ui-confirmdialog-yes"
					icon="ui-icon-check" />
				<p:commandButton value="#{msgs['CONFIRM_DIALOG.NO_LABEL']}"
					type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</p:confirmDialog>

			<p:panel header="#{msgs['ADMINISTRATION.ORGANISATIONS.HEADER']}">
				<p:tabView id="tabViewOrganisations" dynamic="true" cache="false">
					<!--
						There's a problem at the moment with the refresh of tabView's tabs after the association of organisations process.
						For example :
						1) open the "Communities" tab, then open the first community accordion panel,
						2) go to the "Institutions" tab, then open the first institution accordion panel,
						3) change the associated communities, it should update the "institutions" tab
						4) but not the "communities" tab.
						A solution could be to force the user to reopen the accordion panels on the first tab.
						So we would need a way to collapse the accordion when the outer tab changes.
						Unfortunately there's a bug with PrimeFaces 4 (see https://code.google.com/p/primefaces/issues/detail?id=3876)
						that prevent us to put a listener on the outer tabview.
					    TODO : enable this event handler when PF 5 will be used. Then code the onTabViewTabChange method to collapse
					    the accordionPanel before tab switching.
					-->
					<!-- 
					<p:ajax event="tabChange"
						listener="#{organisationsController.onTabViewTabChange}"
						update="@this" />
					-->
					<p:tab
						title="#{msgs['ADMINISTRATION.ORGANISATIONS.TAB_COMMUNITIES_TITLE']}">
						<p:commandButton
							value="#{msgs['ADMINISTRATION.ORGANISATIONS.COMMUNITIES.CREATE_COMMUNITY_LABEL']}"
							icon="ui-icon-plusthick"
							actionListener="#{fileUploadController.reset()}"
							update=":formOrganisations:idDialogCreateCommunity"
							oncomplete="PF('dialogCreateCommunity').show()" process="@this">
							<p:resetInput target=":formOrganisations:idDialogCreateCommunity" />
						</p:commandButton>
						<p:accordionPanel id="accordionPanelForCommunities"
							widgetVar="accordionPanelForCommunitiesWidget"
							value="#{organisationsController.communityViewBeans.tableEntries}"
							var="communityViewBean" activeIndex="-1" dynamic="true"
							collapsible="true">
							<p:ajax event="tabChange"
								listener="#{organisationsController.onAccordionPanelTabChange}"
								update="@this" />
							<p:tab title="#{communityViewBean.name}">
								<p:panelGrid columns="2">
									<p:graphicImage id="communityIcon"
										rendered="#{not empty communityViewBean.iconFileName}"
										styleClass="organisationLogo" alt="#{communityViewBean.name}"
										cache="false" width="150"
										value="#{imagesController.getImage()}">
										<f:param name="imageFileName"
											value="#{communityViewBean.iconFileName}" />
									</p:graphicImage>
									<p:column>
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_LABEL']}"
											icon="ui-icon-transferthick-e-w"
											actionListener="#{organisationsController.setCurrentOrganisationViewBean(communityViewBean)}"
											action="#{organisationsController.preparePicklistInstitutionViewBeansForCurrentOrganisation()}"
											oncomplete="PF('dialogAssociateInstitution').show()"
											update=":formOrganisations:idDialogAssociateInstitution"
											process="@this" />
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_COMMUNITY_LABEL']}"
											icon="ui-icon-pencil"
											actionListener="#{fileUploadController.reset()}"
											action="#{organisationsController.setCurrentOrganisationViewBean(communityViewBean)}"
											update=":formOrganisations:idDialogRenameOrganisation"
											oncomplete="PF('dialogRenameOrganisation').show()"
											process="@this" />
										<p:commandButton id="deleteCommunityButton"
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION_LABEL']}"
											icon="ui-icon-trash"
											actionListener="#{organisationsController.onDeleteOrganisation}"
											action="#{usersController.onDeleteOrganisation}"
											update="accordionPanelForCommunities :formUsers:usersDataTable :formOrganisations:messagesDisplayerFormOrganisations"
											process="@this">
											<p:confirm
												header="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_HEADER']}"
												message="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_QUESTION']}"
												icon="ui-icon-alert" />
										</p:commandButton>
										<p:dataTable id="dataTableInstitutionViewBeansForCommunity"
											var="institutionViewBean"
											emptyMessage="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.LIST.NO_RECORDS_FOUND']}"
											value="#{organisationsController.institutionViewBeansForCurrentOrganisation}">
											<p:column
												headerText="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.LIST.COLUMN_HEADER.NAME']}">
												<h:outputText value="#{institutionViewBean.name}" />
											</p:column>
										</p:dataTable>
									</p:column>
								</p:panelGrid>
							</p:tab>
						</p:accordionPanel>
					</p:tab>

					<p:tab
						title="#{msgs['ADMINISTRATION.ORGANISATIONS.TAB_INSTITUTIONS_TITLE']}">
						<p:commandButton
							value="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.CREATE_INSTITUTION_LABEL']}"
							icon="ui-icon-plusthick"
							actionListener="#{fileUploadController.reset()}"
							update=":formOrganisations:idDialogCreateInstitution"
							oncomplete="PF('dialogCreateInstitution').show()" process="@this">
							<p:resetInput
								target=":formOrganisations:idDialogCreateInstitution" />
						</p:commandButton>
						<p:accordionPanel id="accordionPanelForInstitutions"
							widgetVar="accordionPanelForInstitutionsWidget"
							value="#{organisationsController.institutionViewBeans.tableEntries}"
							var="institutionViewBean" activeIndex="-1" dynamic="true"
							collapsible="true">
							<p:ajax event="tabChange"
								listener="#{organisationsController.onAccordionPanelTabChange}"
								update="@this" />
							<p:tab title="#{institutionViewBean.name}">
								<p:panelGrid columns="2">
									<p:graphicImage id="institutionIcon"
										rendered="#{not empty institutionViewBean.iconFileName}"
										styleClass="organisationLogo"
										alt="#{institutionViewBean.name}" cache="false" width="150"
										value="#{imagesController.getImage()}">
										<f:param name="imageFileName"
											value="#{institutionViewBean.iconFileName}" />
									</p:graphicImage>
									<p:column>
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_INSTITUTION_LABEL']}"
											icon="ui-icon-pencil"
											actionListener="#{fileUploadController.reset()}"
											action="#{organisationsController.setCurrentOrganisationViewBean(institutionViewBean)}"
											update=":formOrganisations:idDialogRenameOrganisation"
											oncomplete="PF('dialogRenameOrganisation').show()"
											process="@this" />
										<p:commandButton id="deleteInstitutionButton"
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION_LABEL']}"
											icon="ui-icon-trash"
											action="#{organisationsController.onDeleteOrganisation}"
											update="accordionPanelForInstitutions :formUsers:usersDataTable :formOrganisations:messagesDisplayerFormOrganisations"
											process="@this">
											<p:confirm
												header="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_HEADER']}"
												message="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_QUESTION']}"
												icon="ui-icon-alert" />
										</p:commandButton>
										<p:panelGrid columns="3">
											<p:column>
												<p:commandButton
													value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_COMMUNITY_LABEL']}"
													icon="ui-icon-transferthick-e-w"
													actionListener="#{organisationsController.setCurrentOrganisationViewBean(institutionViewBean)}"
													action="#{organisationsController.preparePicklistCommunityViewBeansForCurrentOrganisation()}"
													oncomplete="PF('dialogAssociateCommunity').show()"
													update=":formOrganisations:idDialogAssociateCommunity"
													process="@this" />
												<p:dataTable var="communityViewBean"
													emptyMessage="#{msgs['ADMINISTRATION.ORGANISATIONS.COMMUNITIES.LIST.NO_RECORDS_FOUND']}"
													value="#{organisationsController.communityViewBeansForCurrentOrganisation}">
													<p:column
														headerText="#{msgs['ADMINISTRATION.ORGANISATIONS.COMMUNITIES.LIST.COLUMN_HEADER.NAME']}">
														<h:outputText value="#{communityViewBean.name}" />
													</p:column>
												</p:dataTable>
											</p:column>
											<p:column>
												<p:commandButton
													value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_ADMINISTRATIVE_DEPARTMENT_LABEL']}"
													icon="ui-icon-transferthick-e-w"
													actionListener="#{organisationsController.setCurrentOrganisationViewBean(institutionViewBean)}"
													action="#{organisationsController.preparePicklistAdministrativeDepartmentViewBeansForCurrentOrganisation()}"
													oncomplete="PF('dialogAssociateAdministrativeDepartment').show()"
													update=":formOrganisations:idDialogAssociateAdministrativeDepartment"
													process="@this" />
												<p:dataTable var="administrativeDepartmentViewBean"
													emptyMessage="#{msgs['ADMINISTRATION.ORGANISATIONS.ADMINISTRATIVE_DEPARTMENTS.LIST.NO_RECORDS_FOUND']}"
													value="#{organisationsController.administrativeDepartmentViewBeansForCurrentOrganisation}">
													<p:column
														headerText="#{msgs['ADMINISTRATION.ORGANISATIONS.ADMINISTRATIVE_DEPARTMENTS.LIST.COLUMN_HEADER.NAME']}">
														<h:outputText
															value="#{administrativeDepartmentViewBean.name}" />
													</p:column>
												</p:dataTable>
											</p:column>
											<p:column>
												<p:commandButton
													value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_TEACHING_DEPARTMENT_LABEL']}"
													icon="ui-icon-transferthick-e-w"
													actionListener="#{organisationsController.setCurrentOrganisationViewBean(institutionViewBean)}"
													action="#{organisationsController.preparePicklistTeachingDepartmentViewBeansForCurrentOrganisation()}"
													oncomplete="PF('dialogAssociateTeachingDepartment').show()"
													update=":formOrganisations:idDialogAssociateTeachingDepartment"
													process="@this" />
												<p:dataTable var="teachingDepartmentViewBean"
													emptyMessage="#{msgs['ADMINISTRATION.ORGANISATIONS.TEACHING_DEPARTMENTS.LIST.NO_RECORDS_FOUND']}"
													value="#{organisationsController.teachingDepartmentViewBeansForCurrentOrganisation}">
													<p:column
														headerText="#{msgs['ADMINISTRATION.ORGANISATIONS.TEACHING_DEPARTMENTS.LIST.COLUMN_HEADER.NAME']}">
														<h:outputText value="#{teachingDepartmentViewBean.name}" />
													</p:column>
												</p:dataTable>
											</p:column>
										</p:panelGrid>
									</p:column>
								</p:panelGrid>
							</p:tab>
						</p:accordionPanel>
					</p:tab>

					<p:tab
						title="#{msgs['ADMINISTRATION.ORGANISATIONS.TAB_ADMINISTRATIVE_DEPARTMENTS_TITLE']}">
						<p:commandButton
							value="#{msgs['ADMINISTRATION.ORGANISATIONS.ADMINISTRATIVE_DEPARTMENTS.CREATE_ADMINISTRATIVE_DEPARTMENT_LABEL']}"
							icon="ui-icon-plusthick"
							actionListener="#{fileUploadController.reset()}"
							update=":formOrganisations:idDialogCreateAdministrativeDepartment"
							oncomplete="PF('dialogCreateAdministrativeDepartment').show()"
							process="@this">
							<p:resetInput
								target=":formOrganisations:idDialogCreateAdministrativeDepartment" />
						</p:commandButton>
						<p:accordionPanel id="accordionPanelForAdministrativeDepartments"
							value="#{organisationsController.administrativeDepartmentViewBeans.tableEntries}"
							var="administrativeDepartmentViewBean" activeIndex="-1"
							dynamic="true" collapsible="true">
							<p:ajax event="tabChange"
								listener="#{organisationsController.onAccordionPanelTabChange}"
								update="@this" />
							<p:tab title="#{administrativeDepartmentViewBean.name}">
								<p:panelGrid columns="2">
									<p:graphicImage id="administrativeDepartmentIcon"
										rendered="#{not empty administrativeDepartmentViewBean.iconFileName}"
										styleClass="organisationLogo"
										alt="#{administrativeDepartmentViewBean.name}" cache="false"
										width="150" value="#{imagesController.getImage()}">
										<f:param name="imageFileName"
											value="#{administrativeDepartmentViewBean.iconFileName}" />
									</p:graphicImage>
									<p:column>
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_LABEL']}"
											icon="ui-icon-transferthick-e-w"
											actionListener="#{organisationsController.setCurrentOrganisationViewBean(administrativeDepartmentViewBean)}"
											action="#{organisationsController.preparePicklistInstitutionViewBeansForCurrentOrganisation()}"
											oncomplete="PF('dialogAssociateInstitution').show()"
											update=":formOrganisations:idDialogAssociateInstitution"
											process="@this" />
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_ADMINISTRATIVE_DEPARTMENT_LABEL']}"
											icon="ui-icon-pencil"
											actionListener="#{fileUploadController.reset()}"
											action="#{organisationsController.setCurrentOrganisationViewBean(administrativeDepartmentViewBean)}"
											update=":formOrganisations:idDialogRenameOrganisation"
											oncomplete="PF('dialogRenameOrganisation').show()"
											process="@this" />
										<p:commandButton id="deleteAdministrativeDepartmentButton"
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION_LABEL']}"
											icon="ui-icon-trash"
											action="#{organisationsController.onDeleteOrganisation}"
											update="accordionPanelForAdministrativeDepartments :formUsers:usersDataTable :formOrganisations:messagesDisplayerFormOrganisations"
											process="@this">
											<p:confirm
												header="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_HEADER']}"
												message="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_QUESTION']}"
												icon="ui-icon-alert" />
										</p:commandButton>
										<p:dataTable var="institutionViewBean"
											emptyMessage="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.LIST.NO_RECORDS_FOUND']}"
											value="#{organisationsController.institutionViewBeansForCurrentOrganisation}">
											<p:column
												headerText="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.LIST.COLUMN_HEADER.NAME']}">
												<h:outputText value="#{institutionViewBean.name}" />
											</p:column>
										</p:dataTable>
									</p:column>
								</p:panelGrid>
							</p:tab>
						</p:accordionPanel>
					</p:tab>

					<p:tab
						title="#{msgs['ADMINISTRATION.ORGANISATIONS.TAB_TEACHING_DEPARTMENTS_TITLE']}">
						<p:commandButton
							value="#{msgs['ADMINISTRATION.ORGANISATIONS.TEACHING_DEPARTMENTS.CREATE_TEACHING_DEPARTMENT_LABEL']}"
							icon="ui-icon-plusthick"
							actionListener="#{fileUploadController.reset()}"
							update=":formOrganisations:idDialogCreateTeachingDepartment"
							oncomplete="PF('dialogCreateTeachingDepartment').show()"
							process="@this">
							<p:resetInput
								target=":formOrganisations:idDialogCreateTeachingDepartment" />
						</p:commandButton>
						<p:accordionPanel id="accordionPanelForTeachingDepartments"
							value="#{organisationsController.teachingDepartmentViewBeans.tableEntries}"
							var="teachingDepartmentViewBean" activeIndex="-1" dynamic="true"
							collapsible="true">
							<p:ajax event="tabChange"
								listener="#{organisationsController.onAccordionPanelTabChange}"
								update="@this" />
							<p:tab title="#{teachingDepartmentViewBean.name}">
								<p:panelGrid columns="2">
									<p:graphicImage id="teachingDepartmentIcon"
										rendered="#{not empty teachingDepartmentViewBean.iconFileName}"
										styleClass="organisationLogo"
										alt="#{teachingDepartmentViewBean.name}" cache="false"
										width="150" value="#{imagesController.getImage()}">
										<f:param name="imageFileName"
											value="#{teachingDepartmentViewBean.iconFileName}" />
									</p:graphicImage>
									<p:column>
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_LABEL']}"
											icon="ui-icon-transferthick-e-w"
											actionListener="#{organisationsController.setCurrentOrganisationViewBean(teachingDepartmentViewBean)}"
											action="#{organisationsController.preparePicklistInstitutionViewBeansForCurrentOrganisation()}"
											oncomplete="PF('dialogAssociateInstitution').show()"
											update=":formOrganisations:idDialogAssociateInstitution"
											process="@this" />
										<p:commandButton
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_TEACHING_DEPARTMENT_LABEL']}"
											icon="ui-icon-pencil"
											actionListener="#{fileUploadController.reset()}"
											action="#{organisationsController.setCurrentOrganisationViewBean(teachingDepartmentViewBean)}"
											update=":formOrganisations:idDialogRenameOrganisation"
											oncomplete="PF('dialogRenameOrganisation').show()"
											process="@this" />
										<p:commandButton id="deleteTeachingDepartmentButton"
											value="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION_LABEL']}"
											icon="ui-icon-trash"
											action="#{organisationsController.onDeleteOrganisation}"
											update="accordionPanelForTeachingDepartments :formUsers:usersDataTable :formOrganisations:messagesDisplayerFormOrganisations"
											process="@this">
											<p:confirm
												header="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_HEADER']}"
												message="#{msgs['ADMINISTRATION.ORGANISATIONS.DELETE_ORGANISATION.CONFIRMATION_QUESTION']}"
												icon="ui-icon-alert" />
										</p:commandButton>
										<p:dataTable var="institutionViewBean"
											emptyMessage="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.LIST.NO_RECORDS_FOUND']}"
											value="#{organisationsController.institutionViewBeansForCurrentOrganisation}">
											<p:column
												headerText="#{msgs['ADMINISTRATION.ORGANISATIONS.INSTITUTIONS.LIST.COLUMN_HEADER.NAME']}">
												<h:outputText value="#{institutionViewBean.name}" />
											</p:column>
										</p:dataTable>
									</p:column>
								</p:panelGrid>
							</p:tab>
						</p:accordionPanel>
					</p:tab>
				</p:tabView>
			</p:panel>

			<p:dialog id="idDialogCreateCommunity"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_COMMUNITY_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogCreateCommunity" modal="true" height="auto">
				<p:panelGrid columns="3">
					<h:outputLabel for="newCommunityName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_COMMUNITY_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newCommunityName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input1}" />
					<p:message for="newCommunityName" display="text" />

					<h:outputLabel for="newCommunityShortName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_COMMUNITY_MODAL_WINDOW.SHORT_NAME_LABEL']}" />
					<p:inputText id="newCommunityShortName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="20"
						binding="#{input1b}" />
					<p:message for="newCommunityShortName" display="text" />

					<h:outputLabel
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.ICON_LABEL']}"
						for="newCommunityIcon" />
					<p:column rowspan="2">
						<p:fileUpload fileUploadListener="#{fileUploadController.upload}"
							sizeLimit="300000" label="#{msgs['FILEUPLOAD.CHOOSE_LABEL']}"
							uploadLabel="#{msgs['FILEUPLOAD.UPLOAD_LABEL']}"
							cancelLabel="#{msgs['FILEUPLOAD.CANCEL_LABEL']}" fileLimit="1"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" process="@this"
							update="newCommunityIcon :formOrganisations:messagesDisplayerFormOrganisations" />
						<p:graphicImage id="newCommunityIcon" cache="false" width="200"
							value="#{fileUploadController.uploadedFile}" />
					</p:column>
				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_COMMUNITY_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{organisationsController.onCreateCommunity(input1.value, input1b.value, fileUploadController.uploadedFileName)}"
					process="@this idDialogCreateCommunity"
					update=":formOrganisations:idDialogCreateCommunity :formOrganisations:tabViewOrganisations:accordionPanelForCommunities :formOrganisations:messagesDisplayerFormOrganisations"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateCommunity.hide(); }" />
			</p:dialog>

			<p:dialog id="idDialogCreateInstitution"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_INSTITUTION_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogCreateInstitution" modal="true" height="auto">
				<p:panelGrid columns="3">
					<h:outputLabel for="newInstitutionName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_INSTITUTION_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newInstitutionName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input2}" />
					<p:message for="newInstitutionName" display="text" />

					<h:outputLabel for="newInstitutionShortName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_INSTITUTION_MODAL_WINDOW.SHORT_NAME_LABEL']}" />
					<p:inputText id="newInstitutionShortName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="20"
						binding="#{input2b}" />
					<p:message for="newInstitutionShortName" display="text" />

					<h:outputLabel
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.ICON_LABEL']}"
						for="newInstitutionIcon" />
					<p:column rowspan="2">
						<p:fileUpload fileUploadListener="#{fileUploadController.upload}"
							sizeLimit="300000" label="#{msgs['FILEUPLOAD.CHOOSE_LABEL']}"
							uploadLabel="#{msgs['FILEUPLOAD.UPLOAD_LABEL']}"
							cancelLabel="#{msgs['FILEUPLOAD.CANCEL_LABEL']}" fileLimit="1"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" process="@this"
							update="newInstitutionIcon :formOrganisations:messagesDisplayerFormOrganisations" />
						<p:graphicImage id="newInstitutionIcon" cache="false" width="200"
							value="#{fileUploadController.uploadedFile}" />
					</p:column>
				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_INSTITUTION_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{organisationsController.onCreateInstitution(input2.value, input2b.value, fileUploadController.uploadedFileName)}"
					process="@this idDialogCreateInstitution"
					update=":formOrganisations:idDialogCreateInstitution :formOrganisations:tabViewOrganisations:accordionPanelForInstitutions :formUsers:dialogAssociateOrganisationsWithUserPickList :formOrganisations:messagesDisplayerFormOrganisations"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateInstitution.hide(); }" />
			</p:dialog>

			<p:dialog id="idDialogCreateAdministrativeDepartment"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogCreateAdministrativeDepartment" modal="true"
				height="auto">
				<p:panelGrid columns="3">
					<h:outputLabel for="newAdministrativeDepartmentName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newAdministrativeDepartmentName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input3}" />
					<p:message for="newAdministrativeDepartmentName" display="text" />

					<h:outputLabel for="newAdministrativeDepartmentShortName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.SHORT_NAME_LABEL']}" />
					<p:inputText id="newAdministrativeDepartmentShortName"
						required="true" requiredMessage="#{msgs['REQUIRED_FIELD']}"
						size="20" binding="#{input3b}" />
					<p:message for="newAdministrativeDepartmentShortName"
						display="text" />

					<h:outputLabel
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.ICON_LABEL']}"
						for="newAdministrativeDepartmentIcon" />
					<p:column rowspan="2">
						<p:fileUpload fileUploadListener="#{fileUploadController.upload}"
							sizeLimit="300000" label="#{msgs['FILEUPLOAD.CHOOSE_LABEL']}"
							uploadLabel="#{msgs['FILEUPLOAD.UPLOAD_LABEL']}"
							cancelLabel="#{msgs['FILEUPLOAD.CANCEL_LABEL']}" fileLimit="1"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" process="@this"
							update="newAdministrativeDepartmentIcon :formOrganisations:messagesDisplayerFormOrganisations" />
						<p:graphicImage id="newAdministrativeDepartmentIcon" cache="false"
							width="200" value="#{fileUploadController.uploadedFile}" />
					</p:column>
				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{organisationsController.onCreateAdministrativeDepartment(input3.value, input3b.value, fileUploadController.uploadedFileName)}"
					process="@this idDialogCreateAdministrativeDepartment"
					update=":formOrganisations:idDialogCreateAdministrativeDepartment :formOrganisations:tabViewOrganisations:accordionPanelForAdministrativeDepartments :formOrganisations:messagesDisplayerFormOrganisations"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateAdministrativeDepartment.hide(); }" />
			</p:dialog>

			<p:dialog id="idDialogCreateTeachingDepartment"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_TEACHING_DEPARTMENT_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogCreateTeachingDepartment" modal="true"
				height="auto">
				<p:panelGrid columns="3">
					<h:outputLabel for="newTeachingDepartmentName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_TEACHING_DEPARTMENT_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newTeachingDepartmentName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input4}" />
					<p:message for="newTeachingDepartmentName" display="text" />

					<h:outputLabel for="newTeachingDepartmentShortName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_TEACHING_DEPARTMENT_MODAL_WINDOW.SHORT_NAME_LABEL']}" />
					<p:inputText id="newTeachingDepartmentShortName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="20"
						binding="#{input4b}" />
					<p:message for="newTeachingDepartmentShortName" display="text" />

					<h:outputLabel
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.ICON_LABEL']}"
						for="newTeachingDepartmentIcon" />
					<p:column rowspan="2">
						<p:fileUpload fileUploadListener="#{fileUploadController.upload}"
							sizeLimit="300000" label="#{msgs['FILEUPLOAD.CHOOSE_LABEL']}"
							uploadLabel="#{msgs['FILEUPLOAD.UPLOAD_LABEL']}"
							cancelLabel="#{msgs['FILEUPLOAD.CANCEL_LABEL']}" fileLimit="1"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" process="@this"
							update="newTeachingDepartmentIcon :formOrganisations:messagesDisplayerFormOrganisations" />
						<p:graphicImage id="newTeachingDepartmentIcon" cache="false"
							width="200" value="#{fileUploadController.uploadedFile}" />
					</p:column>
				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.CREATE_TEACHING_DEPARTMENT_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{organisationsController.onCreateTeachingDepartment(input4.value, input4b.value, fileUploadController.uploadedFileName)}"
					process="@this idDialogCreateTeachingDepartment"
					update=":formOrganisations:idDialogCreateTeachingDepartment :formOrganisations:tabViewOrganisations:accordionPanelForTeachingDepartments :formOrganisations:messagesDisplayerFormOrganisations"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateTeachingDepartment.hide(); }" />
			</p:dialog>

			<p:dialog id="idDialogRenameOrganisation"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_ORGANISATION_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogRenameOrganisation" modal="true" height="auto">
				<p:panelGrid columns="3"
					rendered="#{organisationsController.currentOrganisationViewBean != null}">
					<h:outputLabel for="newName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_ORGANISATION_MODAL_WINDOW.NEW_NAME_LABEL']}" />
					<p:inputText id="newName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						value="#{organisationsController.currentOrganisationViewBean.name}" />
					<p:message for="newName" display="text" />

					<h:outputLabel for="newShortName"
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_ORGANISATION_MODAL_WINDOW.NEW_SHORTNAME_LABEL']}" />
					<p:inputText id="newShortName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="20"
						value="#{organisationsController.currentOrganisationViewBean.shortname}" />
					<p:message for="newShortName" display="text" />

					<h:outputLabel
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.ICON_LABEL']}"
						for="icon" />
					<p:column rowspan="2">
						<p:fileUpload fileUploadListener="#{fileUploadController.upload}"
							sizeLimit="300000" label="#{msgs['FILEUPLOAD.CHOOSE_LABEL']}"
							uploadLabel="#{msgs['FILEUPLOAD.UPLOAD_LABEL']}"
							cancelLabel="#{msgs['FILEUPLOAD.CANCEL_LABEL']}" fileLimit="1"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" process="@this"
							update="icon :formOrganisations:messagesDisplayerFormOrganisations" />
						<p:panel id="icon">
							<p:graphicImage
								rendered="#{(not empty organisationsController.currentOrganisationViewBean.iconFileName) and (empty fileUploadController.uploadedFileName)}"
								alt="#{organisationsController.currentOrganisationViewBean.name}"
								cache="false" width="200" value="#{imagesController.image}">
								<f:param name="imageFileName"
									value="#{organisationsController.currentOrganisationViewBean.iconFileName}" />
							</p:graphicImage>
							<p:graphicImage
								rendered="#{not empty fileUploadController.uploadedFileName}"
								alt="#{organisationsController.currentOrganisationViewBean.name}"
								cache="false" width="200" value="#{imagesController.image}">
								<f:param name="imageFileName"
									value="#{fileUploadController.uploadedFileName}" />
							</p:graphicImage>
						</p:panel>
					</p:column>
				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.RENAME_ORGANISATION_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					actionListener="#{organisationsController.currentOrganisationViewBean.setIconFileName(fileUploadController.uploadedFileName)}"
					action="#{organisationsController.onRenameOrganisation}"
					process="@this idDialogRenameOrganisation"
					update=":formOrganisations:idDialogRenameOrganisation :formOrganisations:tabViewOrganisations :formUsers:usersDataTable :formOrganisations:messagesDisplayerFormOrganisations"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogRenameOrganisation.hide(); }" />
			</p:dialog>

			<p:dialog id="idDialogAssociateCommunity"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_COMMUNITY_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogAssociateCommunity" modal="true" height="auto">
				<p:pickList id="dialogAssociateCommunityPickList"
					value="#{organisationsController.pickListBean.pickListEntities}"
					var="communityViewBean" itemValue="#{communityViewBean}"
					itemLabel="#{communityViewBean.name}" converter="PickListConverter"
					showSourceControls="false" showTargetControls="false"
					showCheckbox="true" showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains" addLabel="#{msgs['PICKLIST.ADD_LABEL']}"
					addAllLabel="#{msgs['PICKLIST.ADD_ALL_LABEL']}"
					removeLabel="#{msgs['PICKLIST.REMOVE_LABEL']}"
					removeAllLabel="#{msgs['PICKLIST.REMOVE_ALL_LABEL']}">
					<f:facet name="sourceCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_COMMUNITY_MODAL_WINDOW.PICKLIST_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_COMMUNITY_MODAL_WINDOW.PICKLIST_HEADER.ASSOCIATED']}</f:facet>
					<p:ajax event="transfer"
						listener="#{organisationsController.onTransfer}"
						update="@this :formOrganisations:tabViewOrganisations :formOrganisations:messagesDisplayerFormOrganisations"
						process="@this" />
				</p:pickList>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_COMMUNITY_MODAL_WINDOW.CLOSE']}"
					icon="ui-icon-check"
					onclick="PF('dialogAssociateCommunity').hide()" update="@none"
					process="@this idDialogAssociateCommunity" />
			</p:dialog>

			<p:dialog id="idDialogAssociateInstitution"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogAssociateInstitution" modal="true" height="auto">
				<p:pickList id="dialogAssociateInstitutionPickList"
					value="#{organisationsController.pickListBean.pickListEntities}"
					var="institutionViewBean" itemValue="#{institutionViewBean}"
					itemLabel="#{institutionViewBean.name}"
					converter="PickListConverter" showSourceControls="false"
					showTargetControls="false" showCheckbox="true"
					showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains" addLabel="#{msgs['PICKLIST.ADD_LABEL']}"
					addAllLabel="#{msgs['PICKLIST.ADD_ALL_LABEL']}"
					removeLabel="#{msgs['PICKLIST.REMOVE_LABEL']}"
					removeAllLabel="#{msgs['PICKLIST.REMOVE_ALL_LABEL']}">
					<f:facet name="sourceCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_MODAL_WINDOW.PICKLIST_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_MODAL_WINDOW.PICKLIST_HEADER.ASSOCIATED']}</f:facet>
					<p:ajax event="transfer"
						listener="#{organisationsController.onTransfer}"
						update="@this :formOrganisations:tabViewOrganisations :formOrganisations:messagesDisplayerFormOrganisations"
						process="@this" />
				</p:pickList>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_INSTITUTION_MODAL_WINDOW.CLOSE']}"
					icon="ui-icon-check"
					onclick="PF('dialogAssociateInstitution').hide()" update="@none"
					process="@this idDialogAssociateInstitution" />
			</p:dialog>

			<p:dialog id="idDialogAssociateAdministrativeDepartment"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogAssociateAdministrativeDepartment" modal="true"
				height="auto">
				<p:pickList id="dialogAssociateAdministrativeDepartmentPickList"
					value="#{organisationsController.pickListBean.pickListEntities}"
					var="administrativeDepartmentViewBean"
					itemValue="#{administrativeDepartmentViewBean}"
					itemLabel="#{administrativeDepartmentViewBean.name}"
					converter="PickListConverter" showSourceControls="false"
					showTargetControls="false" showCheckbox="true"
					showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains" addLabel="#{msgs['PICKLIST.ADD_LABEL']}"
					addAllLabel="#{msgs['PICKLIST.ADD_ALL_LABEL']}"
					removeLabel="#{msgs['PICKLIST.REMOVE_LABEL']}"
					removeAllLabel="#{msgs['PICKLIST.REMOVE_ALL_LABEL']}">
					<f:facet name="sourceCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.PICKLIST_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.PICKLIST_HEADER.ASSOCIATED']}</f:facet>
					<p:ajax event="transfer"
						listener="#{organisationsController.onTransfer}"
						update="@this :formOrganisations:tabViewOrganisations :formOrganisations:messagesDisplayerFormOrganisations"
						process="@this" />
				</p:pickList>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_ADMINISTRATIVE_DEPARTMENT_MODAL_WINDOW.CLOSE']}"
					icon="ui-icon-check"
					onclick="PF('dialogAssociateAdministrativeDepartment').hide()"
					update="@none"
					process="@this idDialogAssociateAdministrativeDepartment" />
			</p:dialog>

			<p:dialog id="idDialogAssociateTeachingDepartment"
				header="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_TEACHING_DEPARTMENT_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogAssociateTeachingDepartment" modal="true"
				height="auto">
				<p:pickList id="dialogAssociateTeachingDepartmentPickList"
					value="#{organisationsController.pickListBean.pickListEntities}"
					var="teachingDepartmentViewBean"
					itemValue="#{teachingDepartmentViewBean}"
					itemLabel="#{teachingDepartmentViewBean.name}"
					converter="PickListConverter" showSourceControls="false"
					showTargetControls="false" showCheckbox="true"
					showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains" addLabel="#{msgs['PICKLIST.ADD_LABEL']}"
					addAllLabel="#{msgs['PICKLIST.ADD_ALL_LABEL']}"
					removeLabel="#{msgs['PICKLIST.REMOVE_LABEL']}"
					removeAllLabel="#{msgs['PICKLIST.REMOVE_ALL_LABEL']}">
					<f:facet name="sourceCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_TEACHING_DEPARTMENT_MODAL_WINDOW.PICKLIST_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_TEACHING_DEPARTMENT_MODAL_WINDOW.PICKLIST_HEADER.ASSOCIATED']}</f:facet>
					<p:ajax event="transfer"
						listener="#{organisationsController.onTransfer}"
						update="@this :formOrganisations:tabViewOrganisations :formOrganisations:messagesDisplayerFormOrganisations"
						process="@this" />
				</p:pickList>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.ORGANISATIONS.ASSOCIATE_TEACHING_DEPARTMENT_MODAL_WINDOW.CLOSE']}"
					icon="ui-icon-check"
					onclick="PF('dialogAssociateTeachingDepartment').hide()"
					update="@none" process="@this idDialogAssociateTeachingDepartment" />
			</p:dialog>

		</h:form>

		<h:form id="formUsers">
			<p:growl id="messagesDisplayerFormUsers" showDetail="true" />

			<p:panel header="#{msgs['ADMINISTRATION.USERS.HEADER']}">
				<p:dataTable id="usersDataTable" var="personViewBean"
					emptyMessage="#{msgs['ADMINISTRATION.USERS.LIST.NO_RECORDS_FOUND']}"
					value="#{usersController.personViewBeans}">
					<p:column width="20%"
						headerText="#{msgs['ADMINISTRATION.USERS.LIST.NAME.COLUMN_HEADER']}">
						<h:outputText value="#{personViewBean.name}" />
					</p:column>
					<p:column width="20%"
						headerText="#{msgs['ADMINISTRATION.USERS.LIST.LOGIN.COLUMN_HEADER']}">
						<h:outputText value="#{personViewBean.login}" />
					</p:column>
					<p:column width="40%"
						headerText="#{msgs['ADMINISTRATION.USERS.LIST.WORKS_FOR_ORGANISATION.COLUMN_HEADER']}">
						<p:dataTable id="organisationsOfUserDataTable"
							var="organisationViewBean"
							emptyMessage="#{msgs['ADMINISTRATION.USERS.WORKS_FOR_ORGANISATIONS.LIST.NO_RECORDS_FOUND']}"
							value="#{personViewBean.organisationViewBeans}">
							<p:column
								headerText="#{msgs['ADMINISTRATION.USERS.WORKS_FOR_ORGANISATIONS.LIST.COLUMN_HEADER.NAME']}">
								<h:outputText value="#{organisationViewBean.name}" />
							</p:column>
						</p:dataTable>
						<p:commandButton
							value="#{msgs['ADMINISTRATION.USERS.WORKS_FOR_ORGANISATIONS.ASSOCIATE_ORGANISATION_FOR_USER_LABEL']}"
							icon="ui-icon-transferthick-e-w"
							actionListener="#{usersController.setSelectedUserViewBean(personViewBean)}"
							action="#{usersController.preparePicklistOrganisationViewBeans()}"
							oncomplete="PF('dialogAssociateOrganisationWithUser').show()"
							update=":formUsers:idDialogAssociateOrganisationWithUser"
							process="@this" />
					</p:column>
					<p:column width="20%"
						headerText="#{msgs['ADMINISTRATION.USERS.LIST.IS_ADMIN.COLUMN_HEADER']}">
						<p:selectBooleanCheckbox value="#{personViewBean.administrator}">
							<p:ajax update="@this :formUsers:messagesDisplayerFormUsers"
								listener="#{usersController.setAdministrator(personViewBean)}" />
						</p:selectBooleanCheckbox>
					</p:column>
				</p:dataTable>
			</p:panel>
			<p:dialog id="idDialogAssociateOrganisationWithUser"
				header="#{msgs['ADMINISTRATION.USERS.ASSOCIATE_ORGANISATIONS_TO_USER_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogAssociateOrganisationWithUser" modal="true"
				height="auto">
				<p:pickList id="dialogAssociateOrganisationsWithUserPickList"
					value="#{usersController.pickListBean.pickListEntities}"
					var="organisationViewBean" itemValue="#{organisationViewBean}"
					itemLabel="#{organisationViewBean.name}"
					converter="PickListConverter" showSourceControls="false"
					showTargetControls="false" showCheckbox="true"
					showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains"
					itemDisabled="#{usersController.isDisabledInPickList(organisationViewBean)}">
					<f:facet name="sourceCaption">#{msgs['ADMINISTRATION.USERS.ASSOCIATE_ORGANISATIONS_TO_USER_MODAL_WINDOW.PICKLIST_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msgs['ADMINISTRATION.USERS.ASSOCIATE_ORGANISATIONS_TO_USER_MODAL_WINDOW.PICKLIST_HEADER.WORKS_FOR']}</f:facet>
					<p:ajax event="transfer" listener="#{usersController.onTransfer}"
						update="@this :formUsers:usersDataTable :formUsers:messagesDisplayerFormUsers"
						process="@this" />
				</p:pickList>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.USERS.ASSOCIATE_ORGANISATIONS_MODAL_WINDOW.CLOSE']}"
					icon="ui-icon-check"
					onclick="PF('dialogAssociateOrganisationWithUser').hide()"
					update="@none"
					process="@this idDialogAssociateOrganisationWithUser" />
			</p:dialog>
		</h:form>

		<h:form id="formToolCategories">
			<p:growl id="messagesDisplayerFormToolCategories"
				showDetail="true" />
			<p:panel
				header="#{msgs['ADMINISTRATION.TOOL_CATEGORIES.HEADER']}">
				<p:commandButton
					value="#{msgs['ADMINISTRATION.TOOL_CATEGORIES.CREATE_TOOL_CATEGORY_LABEL']}"
					icon="ui-icon-plusthick"
					update=":formToolCategories:idDialogCreateToolCategory"
					oncomplete="PF('dialogCreateToolCategory').show()" process="@this">
					<p:resetInput target=":formToolCategories:idDialogCreateToolCategory" />
				</p:commandButton>
			</p:panel>
			<p:dialog id="idDialogCreateToolCategory"
				header="#{msgs['ADMINISTRATION.TOOL_CATEGORIES.CREATE_TOOL_CATEGORY_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogCreateToolCategory" modal="true"
				height="auto">
				<p:panelGrid columns="3">

					<h:outputLabel for="newToolCategoryName"
						value="#{msgs['ADMINISTRATION.TOOL_CATEGORIES.CREATE_TOOL_CATEGORY_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newToolCategoryName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input5}" />
					<p:message for="newToolCategoryName" display="text" />

					<h:outputLabel for="newToolCategoryDescription"
						value="#{msgs['ADMINISTRATION.TOOL_CATEGORIES.CREATE_TOOL_CATEGORY_MODAL_WINDOW.DESCRIPTION_LABEL']}" />
					<p:inputText id="newToolCategoryDescription" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input5b}" />
					<p:message for="newToolCategoryDescription" display="text" />

					<h:outputLabel
						value="#{msgs['ADMINISTRATION.ORGANISATIONS.ICON_LABEL']}"
						for="newToolCategoryIcon" />
					<p:column rowspan="2">
						<p:fileUpload fileUploadListener="#{fileUploadController.upload}"
							sizeLimit="300000" label="#{msgs['FILEUPLOAD.CHOOSE_LABEL']}"
							uploadLabel="#{msgs['FILEUPLOAD.UPLOAD_LABEL']}"
							cancelLabel="#{msgs['FILEUPLOAD.CANCEL_LABEL']}" fileLimit="1"
							allowTypes="/(\.|\/)(gif|jpe?g|png)$/" process="@this"
							update="newToolCategoryIcon :formOrganisations:messagesDisplayerFormOrganisations" />
						<p:graphicImage id="newToolCategoryIcon" cache="false"
							width="200" value="#{fileUploadController.uploadedFile}" />
					</p:column>

				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['ADMINISTRATION.TOOL_CATEGORIES.CREATE_TOOL_CATEGORY_MODAL_WINDOW.CLOSE']}"
					icon="ui-icon-check"
					action="#{administrationController.createToolCategory(input5.value, input5b.value)}"
					onclick="PF('dialogCreateToolCategory').hide()"
					update="@form :formToolCategories"
					process="@this idDialogCreateToolCategory"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateToolCategory.hide(); }" />
			</p:dialog>
		</h:form>

	</ui:define>
</ui:composition>