<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="../templates/commonLayout.xhtml">

	<!-- Controller associated with this view -->
	<ui:param name="associateBean" value="#{needsAndAnswersController}" />

	<!-- Control display of the layouts -->
	<ui:param name="displayNorth" value="true" />
	<ui:param name="displayWest" value="true" />
	<ui:param name="westPanelCollapsible" value="false"/>
	<ui:param name="westPanelCollapsed" value="false"/>
	<ui:param name="westPanelSize" value="600"/>
	<ui:param name="displayEast" value="false" />
	<ui:param name="displaySouth" value="false" />

	<ui:param name="pageTitle" value="#{associateBean.pageTitle}" />
	<ui:param name="titleContent" value="#{msg['NEEDS_AND_ANSWERS.SELECTED_ANSWER.HEADER']}" />
	<ui:param name="titleWest" value="#{msg['NEEDS_AND_ANSWERS.TREE.HEADER']}" />
	<ui:param name="titlePageOne" value="#{msg['MENU.PEDAGOGICAL_ADVICE']}"/>
	<ui:param name="titlePageTwo" value=""/>

	<ui:define name="west">
		<p:outputPanel>
			<p:contextMenu for="pedagogicalAdviceTree" nodeType="default">
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ASSOCIATE_NEED']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.associateNeedWithSelectedNode}"
					icon="ui-icon-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.EXPAND_ALL']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.expandSelectedNodeIncludingChildren}"
					icon="ui-icon-circlesmall-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.COLLAPSE_ALL']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.collapseSelectedNodeIncludingChildren}"
					icon="ui-icon-circlesmall-minus" />
			</p:contextMenu>
			<p:contextMenu for="pedagogicalAdviceTree"
				nodeType="#{associateBean.treeNodeType_NEED_LEAF}">
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ASSOCIATE_NEED']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.associateNeedWithSelectedNode}"
					icon="ui-icon-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ASSOCIATE_ANSWER']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.associateAnswerWithSelectedNode}"
					icon="ui-icon-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.DELETE_NODE']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.deleteSelectedNode}"
					icon="ui-icon-close" />
			</p:contextMenu>
			<p:contextMenu for="pedagogicalAdviceTree"
				nodeType="#{associateBean.treeNodeType_NEED_WITH_ASSOCIATED_NEEDS}">
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ASSOCIATE_NEED']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.associateNeedWithSelectedNode}"
					icon="ui-icon-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.EXPAND_ALL']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.expandSelectedNodeIncludingChildren}"
					icon="ui-icon-circlesmall-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.COLLAPSE_ALL']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.collapseSelectedNodeIncludingChildren}"
					icon="ui-icon-circlesmall-minus" />
			</p:contextMenu>
			<p:contextMenu for="pedagogicalAdviceTree"
				nodeType="#{associateBean.treeNodeType_NEED_WITH_ASSOCIATED_ANSWERS}">
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ASSOCIATE_ANSWER']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.associateAnswerWithSelectedNode}"
					icon="ui-icon-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.EXPAND_ALL']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.expandSelectedNodeIncludingChildren}"
					icon="ui-icon-circlesmall-plus" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.COLLAPSE_ALL']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.collapseSelectedNodeIncludingChildren}"
					icon="ui-icon-circlesmall-minus" />
			</p:contextMenu>
			<p:contextMenu for="pedagogicalAdviceTree"
				nodeType="#{associateBean.treeNodeType_ANSWER_LEAF}">
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ANSWER.ASSOCIATE_RESOURCE_CATEGORY']}"
					update="pedagogicalAdviceTree" icon="ui-icon-link"
					onclick="PF('dialogAssociateResourceCategory').show()"
					type="button" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.ANSWER.ASSOCIATE_SERVICE']}"
					update="pedagogicalAdviceTree" icon="ui-icon-link"
					onclick="PF('dialogAssociateService').show()" type="button" />
				<p:menuitem
					value="#{msg['NEEDS_AND_ANSWERS.TREE.CONTEXT_MENU.DELETE_NODE']}"
					update="pedagogicalAdviceTree :contentForm:messagesDisplayer"
					action="#{associateBean.deleteSelectedNode}"
					icon="ui-icon-trash" />
			</p:contextMenu>

			<p:tree id="pedagogicalAdviceTree" styleClass="pedagogicalAdviceTree" dynamic="true"
				value="#{associateBean.treeRoot}" var="treeNodeData"
				selectionMode="single"
				selection="#{associateBean.selectedNode}"
				draggable="true" droppable="true" dragdropScope="demo"
				update="contextMenuForNeeds">
				<p:ajax event="dragdrop"
					listener="#{associateBean.onDragDrop}"
					update="@this :contentForm:messagesDisplayer" />
				<p:ajax event="select"
					listener="#{associateBean.onNodeSelect}"
					update=":contentForm:selectedNodeDetailsOutputPanel :contentForm:associatedToolCategoriesTable" />
				<p:treeNode type="default" styleClass="#{treeNodeData.styleClass}">
					<h:outputText value="#{treeNodeData.label}" />
				</p:treeNode>
				<p:treeNode
					type="#{associateBean.treeNodeType_NEED_LEAF}"
					styleClass="#{treeNodeData.styleClass}">
					<p:inplace editor="true" event="dblclick">
						<p:ajax event="save"
							listener="#{associateBean.onLabelSave(treeNodeData)}"
							update="@this" />
						<p:inputText value="#{treeNodeData.label}" />
					</p:inplace>
				</p:treeNode>
				<p:treeNode
					type="#{associateBean.treeNodeType_NEED_WITH_ASSOCIATED_NEEDS}"
					styleClass="#{treeNodeData.styleClass}">
					<p:inplace editor="true" event="dblclick">
						<p:ajax event="save"
							listener="#{associateBean.onLabelSave(treeNodeData)}"
							update="@this" />
						<p:inputText value="#{treeNodeData.label}" />
					</p:inplace>
				</p:treeNode>
				<p:treeNode
					type="#{associateBean.treeNodeType_NEED_WITH_ASSOCIATED_ANSWERS}"
					styleClass="#{treeNodeData.styleClass}">
					<p:inplace editor="true" event="dblclick">
						<p:ajax event="save"
							listener="#{associateBean.onLabelSave(treeNodeData)}"
							update="@this" />
						<p:inputText value="#{treeNodeData.label}" />
					</p:inplace>
				</p:treeNode>
				<p:treeNode
					type="#{associateBean.treeNodeType_ANSWER_LEAF}"
					styleClass="#{treeNodeData.styleClass}">
					<p:inplace editor="true" event="dblclick">
						<p:ajax event="save"
							listener="#{associateBean.onLabelSave(treeNodeData)}"
							update="@this" />
						<p:inputText value="#{treeNodeData.label}" />
					</p:inplace>
				</p:treeNode>
			</p:tree>
		</p:outputPanel>
	</ui:define>

	<ui:define name="content">

		<p:outputPanel id="selectedNodeDetailsOutputPanel">
			<p:panel id="selectedNodeDetails" styleClass="pedagogicalAnswerDetailsPanel"
				rendered="#{(not empty associateBean.selectedNode) and (associateBean.selectedNode.type == associateBean.treeNodeType_ANSWER_LEAF)}">

				<h2><h:outputText value="#{associateBean.selectedAnswer.name}"/></h2>

				<h3 class="section-title"><h:outputText
					value="#{msg['NEEDS_AND_ANSWERS.SELECTED_ANSWER.ASSOCIATED_TOOLS_LABEL']}" /></h3>

				<p:dataTable id="associatedToolCategoriesTable"
					value="#{associateBean.toolCategoryViewBeansForSelectedAnswer}"
					emptyMessage="#{msg['NEEDS_AND_ANSWERS.SELECTED_ANSWER.ASSOCIATED_TOOL_CATEGORIES.LIST.NO_RECORDS_FOUND']}"
					var="toolCategoryViewBean">
					<p:column
						headerText="#{msg['NEEDS_AND_ANSWERS.SELECTED_ANSWER.ASSOCIATED_TOOLS.COLUMNS.TOOL_CATEGORY']}">
						<h:link id="goToToolCategoryBtn" outcome="my-tools">
							<f:param name="toolCategoryId" value="#{toolCategoryViewBean.id}" />
							<h:outputText value="#{toolCategoryViewBean.name}" />
							<h:outputText styleClass="ui-icon ui-icon-arrowthickstop-1-e"
								style="display:inline-block; vertical-align:middle;" />
							<p:tooltip
								value="#{msg['GO_TO_TOOL_CATEGORY.TOOLTIP']}"
								for="goToToolCategoryBtn" />
						</h:link>
					</p:column>
					<p:column headerText="#{msg['NEEDS_AND_ANSWERS.SELECTED_ANSWER.ASSOCIATED_TOOLS.COLUMNS.TOOL_CATEGORY_DESCRIPTION']}">
						<h:outputText value="#{toolCategoryViewBean.description}"/>
					</p:column>
				</p:dataTable>
				<p:commandButton
					value="#{msg['NEEDS_AND_ANSWERS.SELECTED_ANSWER.ASSOCIATE_TOOL_CATEGORIES_LABEL']}"
					rendered="#{sessionController.currentUserViewBean.administrator}"
					icon="ui-icon-transferthick-e-w"
					action="#{associateBean.preparePicklistToolCategoryViewBeansForSelectedAnswer}"
					oncomplete="PF('dialogAssociateResourceCategory').show()"
					update=":defaultDialogForm:idDialogAssociateResourceCategoryWithAnswer"
					process="@this" />

				<h3 class="section-title"><h:outputText
					value="#{msg['NEEDS_AND_ANSWERS.SCENARIOS_EXAMPLES.HEADER']}" /></h3>

				<p:dataTable id="examplesOfScenariosTable"
					value="#{associateBean.scenarioViewBeansRelatedToSelectedAnswer}"
					emptyMessage="#{msg['NEEDS_AND_ANSWERS.SCENARIOS_EXAMPLES.ASSOCIATED_SCENARIOS.LIST.NO_RECORDS_FOUND']}"
					var="scenario">
					<p:column
						headerText="#{msg['NEEDS_AND_ANSWERS.SCENARIOS_EXAMPLES.COLUMNS.TITLE']}">
						<h:link id="goToScenarioBtn" outcome="my-scenarios">
							<f:param name="scenarioId" value="#{scenario.id}" />
							<h:outputText value="#{scenario.name}" />
							<h:outputText styleClass="ui-icon ui-icon-arrowthickstop-1-e"
								style="display:inline-block; vertical-align:middle;" />
							<p:tooltip
								value="#{msg['GO_TO_SCENARIO.TOOLTIP']}"
								for="goToScenarioBtn" />
						</h:link>
					</p:column>
					<p:column
						headerText="#{msg['NEEDS_AND_ANSWERS.SCENARIOS_EXAMPLES.COLUMNS.OBJECTIVE']}">
						<h:outputText value="#{scenario.objective}" />
					</p:column>
					<p:column
						headerText="#{msg['NEEDS_AND_ANSWERS.SCENARIOS_EXAMPLES.COLUMNS.AUTHORS']}">
						<h:outputText value="#{scenario.authors}" />
					</p:column>
				</p:dataTable>
			</p:panel>
		</p:outputPanel>
	</ui:define>

	<ui:define name="defaultDialog">
		<p:dialog id="idDialogAssociateResourceCategoryWithAnswer"
			header="#{msg['NEEDS_AND_ANSWERS.ASSOCIATE_RESOURCE_CATEGORY_DIALOG.HEADER']}"
			widgetVar="dialogAssociateResourceCategory" modal="true"
			height="auto">
			<p:pickList id="dialogAssociateAnswerWithToolCategoryPickList"
				value="#{associateBean.pickListBean.pickListEntities}"
				var="toolCategoryViewBean" itemValue="#{toolCategoryViewBean}"
				itemLabel="#{toolCategoryViewBean.name}"
				converter="PickListConverter" showSourceControls="false"
				showTargetControls="false" showCheckbox="true"
				showSourceFilter="true" showTargetFilter="true"
				filterMatchMode="contains" addLabel="#{msg['PICKLIST.ADD_LABEL']}"
				addAllLabel="#{msg['PICKLIST.ADD_ALL_LABEL']}"
				removeLabel="#{msg['PICKLIST.REMOVE_LABEL']}"
				removeAllLabel="#{msg['PICKLIST.REMOVE_ALL_LABEL']}">
				<f:facet name="sourceCaption">#{msg['NEEDS_AND_ANSWERS.ASSOCIATE_RESOURCE_CATEGORY_DIALOG.PICKLIST_HEADER.AVAILABLE']}</f:facet>
				<f:facet name="targetCaption">#{msg['NEEDS_AND_ANSWERS.ASSOCIATE_RESOURCE_CATEGORY_DIALOG.PICKLIST_HEADER.ASSOCIATED_WITH_SELECTED_ANSWER']}</f:facet>
				<p:ajax event="transfer"
					listener="#{associateBean.onTransferToolCategory}"
					update="@this :contentForm:associatedToolCategoriesTable :contentForm:messagesDisplayer"
					process="@this" />
			</p:pickList>
			<p:commandButton styleClass="dialogValidationButton"
				value="#{msg['NEEDS_AND_ANSWERS.ASSOCIATE_RESOURCE_CATEGORY_DIALOG.CLOSE']}"
				icon="ui-icon-check"
				actionListener="#{associateBean.setScenarioViewBeansRelatedToSelectedAnswer()}"
				onclick="PF('dialogAssociateResourceCategory').hide()"
				update=":contentForm:examplesOfScenariosTable"
				process="@this :defaultDialogForm:idDialogAssociateResourceCategoryWithAnswer" />
		</p:dialog>
	</ui:define>
</ui:composition>