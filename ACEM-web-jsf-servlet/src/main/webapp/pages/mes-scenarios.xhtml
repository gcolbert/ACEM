<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:e="http://commons.esup-portail.org"
	template="../templates/template.xhtml">
	<ui:define name="content">
		<ui:debug hotkey="1"
			rendered="#{facesContext.application.projectStage == 'Development'}" />

		<h:form id="formScenarios">
			<p:growl id="messagesDisplayer" showDetail="true" />

			<p:confirmDialog global="true" showEffect="fade">
				<p:commandButton value="#{msgs['CONFIRM_DIALOG.YES_LABEL']}"
					type="button" styleClass="ui-confirmdialog-yes"
					icon="ui-icon-check" />
				<p:commandButton value="#{msgs['CONFIRM_DIALOG.NO_LABEL']}"
					type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</p:confirmDialog>

			<p:layout id="layout">

				<p:layoutUnit position="west" resizable="true">
					<p:panel header="#{msgs['MY_SCENARIOS.HEADER']}">
						<p:panelGrid columns="1">
							<p:commandButton
								value="#{msgs['MY_SCENARIOS.CREATE_SCENARIO_LABEL']}"
								icon="ui-icon-plusthick"
								onclick="PF('dialogCreateScenario').show()" />
							<p:scrollPanel mode="native">
								<p:dataTable id="scenariosDataTable"
									emptyMessage="#{msgs['MY_SCENARIOS.LIST.NO_RECORDS_FOUND']}"
									value="#{myScenariosController.scenarios}" var="scenario"
									selection="#{myScenariosController.selectedScenario}"
									selectionMode="single" rowKey="#{scenario.id}">
									<p:ajax event="rowSelect"
										listener="#{myScenariosController.onScenarioRowSelect}"
										update="@form" />
									<p:ajax event="rowUnselect"
										listener="#{myScenariosController.onRowUnselect}"
										update="@form" />
									<p:column
										headerText="#{msgs['MY_SCENARIOS.LIST.COLUMN_HEADER']}">
									    #{scenario.name}
									</p:column>
								</p:dataTable>
							</p:scrollPanel>
							<p:commandButton id="deleteScenarioButton"
								value="#{msgs['MY_SCENARIOS.DELETE_SCENARIO_LABEL']}"
								icon="ui-icon-trash"
								action="#{myScenariosController.deleteSelectedScenario}"
								disabled="#{myScenariosController.selectedScenario == null}"
								update="@form">
								<p:confirm
									header="#{msgs['MY_SCENARIOS.DELETE_SCENARIO.CONFIRMATION_HEADER']}"
									message="#{msgs['MY_SCENARIOS.DELETE_SCENARIO.CONFIRMATION_QUESTION']}"
									icon="ui-icon-alert" />
							</p:commandButton>
						</p:panelGrid>
					</p:panel>
				</p:layoutUnit>

				<p:layoutUnit position="center">
					<p:panel header="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.HEADER']}"
						rendered="#{myScenariosController.selectedScenario != null}">

						<h:panelGrid columns="2">
							<h:outputLabel for="selectedScenarioName"
								value="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.NAME_LABEL']}"
								styleClass="label" />
							<p:panel>
								<p:inplace id="selectedScenarioNameInplace" editor="true">
									<p:ajax event="save"
										listener="#{myScenariosController.onSave}"
										update="@form" />
									<p:ajax event="cancel" update="@this" />
									<h:inputText id="selectedScenarioName"
										value="#{myScenariosController.selectedScenario.name}"
										required="true" requiredMessage="#{msgs['REQUIRED_FIELD']}" />
								</p:inplace>
							</p:panel>

							<h:outputLabel for="selectedScenarioObjective"
								value="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.OBJECTIVE_LABEL']}"
								styleClass="label" />
							<p:panel>
								<p:inplace id="selectedScenarioObjectiveInplace" editor="true">
									<p:ajax event="save"
										listener="#{myScenariosController.onSave}"
										update="@form" />
									<p:ajax event="cancel" update="@this" />
									<h:inputText id="selectedScenarioObjective"
										value="#{myScenariosController.selectedScenario.objective}"
										required="true" requiredMessage="#{msgs['REQUIRED_FIELD']}" />
								</p:inplace>
							</p:panel>
						</h:panelGrid>

						<p:dataTable id="selectedScenarioActivitiesDataTable"
							editable="true"
							emptyMessage="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.NO_RECORDS_FOUND']}"
							value="#{myScenariosController.selectedScenarioPedagogicalActivities}"
							var="activity">

							<f:facet name="header">#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.TABLE_HEADER']}</f:facet>

							<p:ajax event="rowEdit"
								listener="#{myScenariosController.onActivityRowEdit}"
								update=":formScenarios:messagesDisplayer" />

							<p:ajax event="rowEditCancel" update="@this" />

							<p:column width="20"
								headerText="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_POSITION_IN_SCENARIO']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{activity.positionInScenario}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{activity.positionInScenario}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_NAME']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{activity.name}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{activity.name}" style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_OBJECTIVE']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{activity.objective}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{activity.objective}" style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_DESCRIPTION']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{activity.description}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{activity.description}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column width="20"
								headerText="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_DURATION']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{activity.duration}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{activity.duration}" style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_RESOURCES']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{activity.resources}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{activity.resources}" style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column style="width:6%">
								<p:rowEditor />
							</p:column>
						</p:dataTable>

						<p:commandButton
							value="#{msgs['MY_SCENARIOS.SELECTED_SCENARIO.ADD_ACTIVITY_LABEL']}"
							icon="ui-icon-plusthick"
							action="#{myScenariosController.onCreateActivity}"
							update="@form" />

					</p:panel>
				</p:layoutUnit>
			</p:layout>
		</h:form>

		<p:dialog
			header="#{msgs['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.HEADER']}"
			widgetVar="dialogCreateScenario" modal="true" height="auto">
			<h:form id="formCreateScenario">
				<h:panelGrid columns="3">
					<h:outputLabel for="newScenarioName"
						value="#{msgs['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newScenarioName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input1}" />
					<p:message for="newScenarioName" display="text" />

					<h:outputLabel for="newScenarioObjective"
						value="#{msgs['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.OBJECTIVE_LABEL']}" />
					<p:inputText id="newScenarioObjective" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input2}" />
					<p:message for="newScenarioObjective" display="text" />
				</h:panelGrid>

				<p:commandButton
					value="#{msgs['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{myScenariosController.createScenario(input1.value, input2.value)}"
					update="@form :formScenarios"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateScenario.hide(); }" />
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>