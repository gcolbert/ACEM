<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:e="http://commons.esup-portail.org"
	template="../templates/template.xhtml">
	<f:metadata>
		<f:viewParam name="resourceId"
			value="#{resourcesTreeController.selectedResourceId}" />
		<f:viewParam name="resourceId"
			value="#{resourcesSelectedResourceController.selectedResourceId}" />
	</f:metadata>
	<ui:define name="content">
		<ui:debug hotkey="1"
			rendered="#{facesContext.application.projectStage == 'Development'}" />

		<h:form id="formResources">
			<p:panel header="#{msgs['RESOURCES.TREE.HEADER']}">

				<p:growl id="messagesDisplayer" showDetail="true" />

				<p:contextMenu for="resourcesTree" nodeType="default">
					<p:menuitem
						value="#{msgs['RESOURCES.TREE.CONTEXT_MENU.CREATE_RESOURCE']}"
						update=":formCreateResource"
						oncomplete="PF('dialogCreateResource').show()" icon="ui-icon-plus">
						<p:resetInput target=":formCreateResource" />
					</p:menuitem>
				</p:contextMenu>
				<p:contextMenu for="resourcesTree" nodeType="category">
					<p:menuitem
						value="#{msgs['RESOURCES.TREE.CONTEXT_MENU.CREATE_RESOURCE']}"
						update=":formCreateResource"
						oncomplete="PF('dialogCreateResource').show()" icon="ui-icon-plus">
						<p:resetInput target=":formCreateResource" />
					</p:menuitem>
				</p:contextMenu>
				<!-- 
				<p:contextMenu for="resourcesTree" nodeType="resource">
					<p:menuitem
						value="#{msgs['RESOURCES.TREE.CONTEXT_MENU.ASSOCIATE_USE_MODE']}"
						update=":formAssociateUseMode"
						oncomplete="PF('dialogAssociateUseMode').show()" icon="ui-icon-plus">
						<p:resetInput target=":formAssociateUseMode" />
					</p:menuitem>
				</p:contextMenu>
				-->

				<p:panelGrid styleClass="menu" columns="5">
					<p:commandLink styleClass="menu-entry"
						action="#{resourcesTreeController.prepareTree('equipment')}"
						update=":formResources:resourcesTree">
						<h:graphicImage
							url="resources/images/my-tools/my-tools.equipments.png"
							alt="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.EQUIPMENT.LABEL']}"
							styleClass="menu-entry-image" />
						<span class="menu-entry-text"><h:outputText
								value="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.EQUIPMENT.LABEL']}" /></span>
					</p:commandLink>
					<p:commandLink styleClass="menu-entry"
						action="#{resourcesTreeController.prepareTree('software')}"
						update=":formResources:resourcesTree">
						<h:graphicImage
							url="resources/images/my-tools/my-tools.softwares.png"
							alt="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.SOFTWARE.LABEL']}"
							styleClass="menu-entry-image" />
						<span class="menu-entry-text"><h:outputText
								value="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.SOFTWARE.LABEL']}" /></span>
					</p:commandLink>
					<p:commandLink styleClass="menu-entry"
						action="#{resourcesTreeController.prepareTree('softwareDocumentation')}"
						update=":formResources:resourcesTree">
						<h:graphicImage
							url="resources/images/my-tools/my-tools.software-documentations.png"
							alt="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.SOFTWARE_DOCUMENTATION.LABEL']}"
							styleClass="menu-entry-image" />
						<span class="menu-entry-text"><h:outputText escape="false"
								value="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.SOFTWARE_DOCUMENTATION.LABEL']}" /></span>
					</p:commandLink>
					<p:commandLink styleClass="menu-entry"
						action="#{resourcesTreeController.prepareTree('pedagogicalAndDocumentaryResources')}"
						update=":formResources:resourcesTree">
						<h:graphicImage
							url="resources/images/my-tools/my-tools.pedagogical-and-documentary-resources.png"
							alt="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.PEDAGOGICAL_AND_DOCUMENTARY_RESOURCES.LABEL']}"
							styleClass="menu-entry-image" />
						<span class="menu-entry-text"><h:outputText escape="false"
								value="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.PEDAGOGICAL_AND_DOCUMENTARY_RESOURCES.LABEL']}" /></span>
					</p:commandLink>
					<p:commandLink styleClass="menu-entry"
						action="#{resourcesTreeController.prepareTree('professionalTraining')}"
						update=":formResources:resourcesTree">
						<h:graphicImage
							url="resources/images/my-tools/my-tools.professional-trainings.png"
							alt="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.PROFESSIONAL_TRAININGS.LABEL']}"
							styleClass="menu-entry-image" />
						<span class="menu-entry-text"><h:outputText
								value="#{msgs['RESOURCES.TREE.VISIBLE_ROOTS.PROFESSIONAL_TRAININGS.LABEL']}" /></span>
					</p:commandLink>
				</p:panelGrid>

				<p:tree id="resourcesTree" dynamic="true"
					datakey="#{treeNodeData.id}"
					value="#{resourcesTreeController.treeRoot}" var="treeNodeData"
					selectionMode="single"
					onNodeClick="if ( (node.attr('data-nodetype')!='default') &amp;&amp; (node.attr('data-nodetype')!='category') ) { history.pushState('','','my-tools?resourceId='+node.attr('data-datakey')); }"
					selection="#{resourcesTreeController.selectedNode}">
					<p:ajax event="select"
						update=":formResources:selectedResourcePanel :formResources:messagesDisplayer"
						listener="#{resourcesTreeController.onNodeSelect}" />
					<p:treeNode type="default" styleClass="#{treeNodeData.styleClass}">
						<h:outputText value="#{treeNodeData.label}" />
					</p:treeNode>
					<p:treeNode type="category" styleClass="#{treeNodeData.styleClass}">
						<h:outputText value="#{treeNodeData.label}" />
					</p:treeNode>
					<p:treeNode type="software" styleClass="#{treeNodeData.styleClass}">
						<h:outputText value="#{treeNodeData.label}" />
					</p:treeNode>
					<p:treeNode type="softwareDocumentation"
						styleClass="#{treeNodeData.styleClass}">
						<h:outputText value="#{treeNodeData.label}" />
					</p:treeNode>
					<p:treeNode type="equipment"
						styleClass="#{treeNodeData.styleClass}">
						<h:outputText value="#{treeNodeData.label}" />
					</p:treeNode>
					<p:treeNode type="pedagogicalAndDocumentaryResources"
						styleClass="#{treeNodeData.styleClass}">
						<h:outputText value="#{treeNodeData.label}" />
					</p:treeNode>
				</p:tree>
			</p:panel>

			<p:panel header="#{msgs['RESOURCES.SELECTED_RESOURCE.HEADER']}"
				id="selectedResourcePanel">
				<p:panelGrid columns="1"
					rendered="#{resourcesSelectedResourceController.selectedResourceViewBean != null}">

					<h:outputText styleClass="title"
						value="#{resourcesSelectedResourceController.selectedResourceViewBean.name}" />

					<!-- 
						<p:fileUpload fileUploadListener="#{fileController.handleFileUpload}" />
						-->
					<!-- 
						<p:graphicImage value="#{imagesController.image}" title="#{resourcesSelectedResourceController.selectedResourceViewBean.name}">
							<f:param name="imageId" value="#{resourcesSelectedResourceController.selectedResourceViewBean.id}" />
						</p:graphicImage>
						 -->

					<h:panelGroup>
						<p:selectBooleanCheckbox id="favoriteResource"
							value="#{resourcesSelectedResourceController.selectedResourceViewBean.favoriteResource}" />
						<p:outputLabel for="favoriteResource"
							value="#{msgs['RESOURCES.SELECTED_RESOURCE.ADD_TO_MY_FAVORITE_TOOLS']}" />
					</h:panelGroup>

					<p:outputLabel
						value="#{msgs['RESOURCES.SELECTED_RESOURCE.ASSOCIATED_PEDAGOGICAL_ADVICE_LABEL']}"
						for="pedagogicalUseTree" />
					<p:tree id="pedagogicalUseTree" dynamic="true"
						value="#{resourcesSelectedResourceController.treeRoot}"
						var="treeNodeData">
						<p:treeNode type="default" styleClass="#{treeNodeData.styleClass}">
							<h:outputText value="#{treeNodeData.label}" />
						</p:treeNode>
						<p:treeNode
							type="#{needsAndAnswersTreeController.treeNodeType_NEED_LEAF}"
							styleClass="#{treeNodeData.styleClass}">
							<h:outputText value="#{treeNodeData.label}" />
						</p:treeNode>
						<p:treeNode
							type="#{needsAndAnswersTreeController.treeNodeType_NEED_WITH_ASSOCIATED_NEEDS}"
							styleClass="#{treeNodeData.styleClass}">
							<h:outputText value="#{treeNodeData.label}" />
						</p:treeNode>
						<p:treeNode
							type="#{needsAndAnswersTreeController.treeNodeType_NEED_WITH_ASSOCIATED_ANSWERS}"
							styleClass="#{treeNodeData.styleClass}">
							<h:outputText value="#{treeNodeData.label}" />
						</p:treeNode>
						<p:treeNode
							type="#{needsAndAnswersTreeController.treeNodeType_ANSWER_LEAF}"
							styleClass="#{treeNodeData.styleClass}">
							<h:outputText value="#{treeNodeData.label}" />
						</p:treeNode>
					</p:tree>

					<p:outputLabel
						value="#{msgs['RESOURCES.SELECTED_RESOURCE.SCENARIOS_USING_SELECTED_TOOL_LABEL']}"
						for="scenariosUsingSelectedToolTable" />

					<p:dataTable id="scenariosUsingSelectedToolTable"
						value="#{resourcesSelectedResourceController.scenariosUsingSelectedTool}"
						var="scenario">
						<p:column
							headerText="#{msgs['RESOURCES.SELECTED_RESOURCE.SCENARIOS.COLUMNS.TITLE']}">
							<h:outputText value="#{scenario.name}" />
						</p:column>
						<p:column
							headerText="#{msgs['RESOURCES.SELECTED_RESOURCE.SCENARIOS.COLUMNS.OBJECTIVE']}">
							<h:outputText value="#{scenario.objective}" />
						</p:column>
						<p:column
							headerText="#{msgs['RESOURCES.SELECTED_RESOURCE.SCENARIOS.COLUMNS.AUTHOR']}">
							<h:outputText value="#{scenario.author}" />
						</p:column>
					</p:dataTable>

				</p:panelGrid>
			</p:panel>

			<p:panelGrid styleClass="bottom-toolboxes">
				<p:row>
					<p:column width="50%">
						<p:panel
							header="#{msgs['RESOURCES.MY_FAVORITE_RESOURCES.HEADER']}">
						</p:panel>
					</p:column>
					<p:column width="50%">
						<p:panel
							header="#{msgs['RESOURCES.LAST_VIEWED_RESOURCES.HEADER']}">
						</p:panel>
					</p:column>
				</p:row>
			</p:panelGrid>

		</h:form>

		<p:dialog id="dialogCreateResourceId"
			header="#{msgs['RESOURCES.CREATE_RESOURCE_MODAL_WINDOW.HEADER']}"
			widgetVar="dialogCreateResource" modal="true" height="auto">
			<h:form id="formCreateResource">
				<p:panelGrid columns="3">
					<h:outputLabel for="newResourceCategory"
						value="#{msgs['RESOURCES.CREATE_RESOURCE_MODAL_WINDOW.CATEGORY_LABEL']}" />
					<p:selectOneMenu id="newResourceCategory" effect="fold"
						required="true" requiredMessage="#{msgs['REQUIRED_FIELD']}"
						editable="true" binding="#{input1}">
						<f:selectItem
							itemLabel="#{msgs['RESOURCES.CREATE_RESOURCE_MODAL_WINDOW.SELECT_CATEGORY_OR_TYPE_A_NEW_ONE_LABEL']}"
							itemValue="" itemDisabled="true" noSelectionOption="true" />
						<f:selectItems
							value="#{resourcesTreeController.categoriesForSelectedResourceType}" />
					</p:selectOneMenu>
					<p:message for="newResourceCategory" display="text" />

					<h:outputLabel for="newSoftwareName"
						value="#{msgs['RESOURCES.CREATE_RESOURCE_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newSoftwareName" required="true"
						requiredMessage="#{msgs['REQUIRED_FIELD']}" size="50"
						binding="#{input2}" />
					<p:message for="newSoftwareName" display="text" />

				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msgs['RESOURCES.CREATE_SCENARIO_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{resourcesTreeController.createResourceForSelectedResourceType(input1.value, input2.value)}"
					update="@form :formResources"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateResource.hide(); }" />
			</h:form>
		</p:dialog>

		<p:dialog id="dialogAssociateUseModeId"
			header="#{msgs['RESOURCES.ASSOCIATE_USE_MODE_MODAL_WINDOW.HEADER']}"
			widgetVar="dialogAssociateUseMode" modal="true" height="auto">
			<h:form id="formAssociateUseMode">

			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>