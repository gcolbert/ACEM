<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="../templates/commonLayout.xhtml">

	<f:metadata>
		<f:viewParam name="scenarioId"
			value="#{myScenariosController.selectedScenarioId}" />
	</f:metadata>

	<!-- Controller associated with this view -->
	<ui:param name="associateBean" value="#{myScenariosController}" />

	<!-- Control display of the layouts -->
	<ui:param name="displayNorth" value="true" />
	<ui:param name="northPanelCollapsible" value="true"/>
	<ui:param name="northPanelCollapsed" value="false"/>

	<ui:param name="displayWest" value="true" />
	<ui:param name="titleWest" value="#{msg['MY_SCENARIOS.LIST_USER_SCENARIOS.HEADER']}" />
	<ui:param name="westPanelCollapsible" value="true"/>
	<ui:param name="westPanelCollapsed" value="false"/>

	<ui:param name="displayEast" value="false" />

	<ui:param name="displaySouth" value="true" />
	<ui:param name="titleSouth" value="#{msg['MY_SCENARIOS.CONTROLS.HEADER']}"/>
	<ui:param name="southPanelCollapsible" value="true"/>
	<ui:param name="southPanelCollapsed" value="false"/>

	<ui:param name="pageTitle" value="#{associateBean.pageTitle}" />
	<ui:param name="titleContent" value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.HEADER']}" />
	<ui:param name="titlePageOne" value="#{msg['MY_SCENARIOS.TITLE']}"/>
	<ui:param name="titlePageTwo" value=""/>

	<!-- List of user's scenarios in west layout -->
	<ui:define name="west">
		<p:panelGrid columns="1" styleClass="userScenariosPanel">
			<p:commandButton value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_LABEL']}"
				icon="ui-icon-plusthick" update=":createScenarioForm:dialogCreateScenarioId"
				oncomplete="PF('dialogCreateScenario').show()">
				<p:resetInput target=":createScenarioForm:dialogCreateScenarioId" />
			</p:commandButton>
			<p:scrollPanel mode="native" styleClass="userScenariosScrollPanel">
				<p:dataTable id="scenariosDataTable"
					emptyMessage="#{msg['MY_SCENARIOS.LIST.NO_RECORDS_FOUND']}"
					value="#{associateBean.scenarioViewBeans}"
					var="scenarioViewBean" rowKey="#{scenarioViewBean.id}"
					selection="#{associateBean.selectedScenarioViewBean}"
					selectionMode="single">
					<p:ajax event="rowSelect"
						listener="#{associateBean.onScenarioRowSelect}"
						update=":contentForm :southForm" />
					<p:column styleClass="userScenariosScrollPanelColumn"
						headerText="#{msg['MY_SCENARIOS.LIST.COLUMN_HEADER']}">
						<h:outputText id="scenario" value="#{scenarioViewBean.name}" />
						<p:tooltip for="scenario" value="#{scenarioViewBean.objective}" />  
					</p:column>
				</p:dataTable>
			</p:scrollPanel>
		</p:panelGrid>
	</ui:define>

	<!-- Actions for selected scenario in footer -->
	<ui:define name="footer">
		<p:commandButton icon="ui-icon-check"
			value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.SAVE_LABEL']}"
			action="#{associateBean.onSave}"
			disabled="#{associateBean.selectedScenarioViewBean == null}"
			update=":contentForm:messagesDisplayer" />
		<p:commandButton id="deleteScenarioButton"
			value="#{msg['MY_SCENARIOS.DELETE_SCENARIO_LABEL']}"
			icon="ui-icon-trash" action="#{associateBean.deleteSelectedScenario}"
			disabled="#{associateBean.selectedScenarioViewBean == null}"
			update=":westForm:scenariosDataTable :southForm :contentForm">
			<p:confirm
				header="#{msg['MY_SCENARIOS.DELETE_SCENARIO.CONFIRMATION_HEADER']}"
				message="#{msg['MY_SCENARIOS.DELETE_SCENARIO.CONFIRMATION_QUESTION']}"
				icon="ui-icon-alert" />
		</p:commandButton>
	</ui:define>

	<!--  Selected scenario in center layout -->
	<ui:define name="content">
		<p:outputPanel id="selectedScenarioOutputPanel">
			<p:panel styleClass="selectedScenarioPanel"
				id="selectedScenarioPanel"
				rendered="#{associateBean.selectedScenarioViewBean != null}">

				<h2><h:outputText id="selectedScenarioName"
						value="#{associateBean.selectedScenarioViewBean.name}" /></h2>
				<p:panelGrid columns="2" styleClass="selectedScenarioPropertiesPanelGrid">
					<p:outputLabel for="selectedScenarioObjective"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.OBJECTIVE_LABEL']}"
						styleClass="label" />
					<h:outputText id="selectedScenarioObjective"
						value="#{associateBean.selectedScenarioViewBean.objective}" />
	
					<p:outputLabel for="selectedScenarioAuthors"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.AUTHORS_LABEL']}"
						styleClass="label" />
					<h:outputText  id="selectedScenarioAuthors"
						value="#{associateBean.selectedScenarioViewBean.authors}" />
	
					<p:outputLabel for="selectedScenarioCreationDate"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.CREATION_DATE_LABEL']}"
						styleClass="label" />
					<h:outputText id="selectedScenarioCreationDate"
						value="#{associateBean.selectedScenarioViewBean.creationDate}" />
	
					<p:outputLabel for="selectedScenarioModificationDate"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.MODIFICATION_DATE_LABEL']}"
						styleClass="label" />
					<h:outputText id="selectedScenarioModificationDate"
						value="#{associateBean.selectedScenarioViewBean.modificationDate}" />
				</p:panelGrid>
				<p:commandButton 
					value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EDIT_PEDAGOGICAL_SCENARIO_LABEL']}"
					icon="ui-icon-pencil"
					actionListener="#{associateBean.setSelectedPedagogicalActivityViewBean(pedagogicalActivityViewBean)}"
					action="#{associateBean.preparePicklistToolCategoryViewBeansForPedagogicalActivity(pedagogicalActivityViewBean)}"
					oncomplete="PF('dialogEditScenario').show()"
					update=":modifyScenarioForm:dialogEditScenarioId"
					process="@this" />
	
				<!-- 
				<ui:repeat id="favoriteToolCategories"
					value="#{associateBean.selectedScenarioViewBean.pedagogicalActivityViewBeans}"
					var="pedagogicalActivityViewBean">
	
					<p:outputLabel styleClass="label"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_POSITION_IN_SCENARIO']}"/>
					<h:outputText value="#{pedagogicalActivityViewBean.positionInScenario}" />
	
					<p:outputLabel styleClass="label"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_NAME']}"/>
					<h:outputText value="#{pedagogicalActivityViewBean.name}" />
	
					<p:outputLabel styleClass="label"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_OBJECTIVE']}"/>
					<h:outputText value="#{pedagogicalActivityViewBean.objective}" />
	
					<p:outputLabel styleClass="label"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_INSTRUCTIONS']}"/>
					<h:outputText value="#{pedagogicalActivityViewBean.instructions}" />
	
					<p:outputLabel styleClass="label"
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_DURATION']}"/>
					<h:outputText value="#{pedagogicalActivityViewBean.duration}" />
	
					<p:outputLabel styleClass="label"
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_TOOLS']}"/>
					<h:outputText value="#{pedagogicalActivityViewBean.resources}" />
	
					<p:commandButton 
						value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EDIT_PEDAGOGICAL_ACTIVITY_LABEL']}"
						icon="ui-icon-pencil"
						actionListener="#{associateBean.setSelectedPedagogicalActivityViewBean(pedagogicalActivityViewBean)}"
						action="#{associateBean.preparePicklistToolCategoryViewBeansForPedagogicalActivity(pedagogicalActivityViewBean)}"
						oncomplete="PF('dialogEditActivity').show()"
						update=":modifyActivityForm:dialogEditActivityId"
						process="@this" />
	
				</ui:repeat>
				-->
	
				<p:dataTable id="pedagogicalActivitiesDataTable" styleClass="selectedScenarioActivitiesDataTable"
					editable="true"
					emptyMessage="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.NO_RECORDS_FOUND']}"
					value="#{associateBean.selectedScenarioViewBean.pedagogicalActivityViewBeans}"
					var="pedagogicalActivityViewBean"
					rowKey="pedagogicalActivityViewBean.id">
	
					<f:facet name="header">#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.TABLE_HEADER']}</f:facet>
	
					<p:column width="20"
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_POSITION_IN_SCENARIO']}">
						<h:outputText
							value="#{pedagogicalActivityViewBean.positionInScenario}" />
					</p:column>
					<p:column
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_NAME']}">
						<h:outputText value="#{pedagogicalActivityViewBean.name}" escape="false" />
					</p:column>
					<p:column
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_OBJECTIVE']}">
						<h:outputText value="#{pedagogicalActivityViewBean.objective}" escape="false" />
					</p:column>
					<p:column
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_INSTRUCTIONS']}">
						<h:outputText value="#{pedagogicalActivityViewBean.instructions}" escape="false" />
					</p:column>
					<p:column
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_DURATION']}">
						<h:outputText value="#{pedagogicalActivityViewBean.duration}" escape="false" />
					</p:column>
					<p:column
						headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_TOOLS']}">
						<ui:repeat id="requiredToolCategories"
							value="#{pedagogicalActivityViewBean.toolCategoryViewBeans}"
							var="toolCategoryViewBean">
							<h:link id="goToToolCategoryBtn" outcome="my-tools">
								<f:param name="toolCategoryId"
									value="#{toolCategoryViewBean.id}" />
								<h:outputText value="#{toolCategoryViewBean.name}"
									rendered="#{empty toolCategoryViewBean.iconFileName}" />
								<p:graphicImage rendered="#{not empty toolCategoryViewBean.iconFileName}"
									styleClass="toolCategoryLogo"
									alt="#{toolCategoryViewBean.name}" cache="true" width="50"
									value="#{imagesController.getImage()}">
									<f:param name="imageFileName"
										value="#{toolCategoryViewBean.iconFileName}" />
								</p:graphicImage>
							</h:link>
							<p:tooltip for="goToToolCategoryBtn"
								value="#{toolCategoryViewBean.name}" />
						</ui:repeat>
					</p:column>
					<p:column>
						<p:commandButton 
							value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EDIT_PEDAGOGICAL_ACTIVITY_LABEL']}"
							icon="ui-icon-pencil"
							actionListener="#{associateBean.setSelectedPedagogicalActivityViewBean(pedagogicalActivityViewBean)}"
							action="#{associateBean.preparePicklistToolCategoryViewBeansForPedagogicalActivity(pedagogicalActivityViewBean)}"
							oncomplete="PF('dialogEditActivity').show()"
							update=":modifyActivityForm:dialogEditActivityId"
							process="@this" />
						<p:commandButton 
							value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.DELETE_PEDAGOGICAL_ACTIVITY_LABEL']}"
							icon="ui-icon-trash"
							action="#{associateBean.onDeletePedagogicalActivity(pedagogicalActivityViewBean)}"
							update=":contentForm:pedagogicalActivitiesDataTable"
							process="@this">
							<p:confirm
								header="#{msg['MY_SCENARIOS.DELETE_PEDAGOGICAL_ACTIVITY.CONFIRMATION_HEADER']}"
								message="#{msg['MY_SCENARIOS.DELETE_PEDAGOGICAL_ACTIVITY.CONFIRMATION_QUESTION']}"
								icon="ui-icon-alert" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
	
				<p:commandButton
					value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.ADD_ACTIVITY_LABEL']}"
					icon="ui-icon-plusthick"
					action="#{associateBean.prepareCreatePedagogicalActivity()}"
					oncomplete="PF('dialogEditActivity').show()"
					update=":modifyActivityForm:dialogEditActivityId"
					process="@this">
					<p:resetInput target=":modifyActivityForm:dialogEditActivityId" />
				</p:commandButton>

				<p:panel id="evaluationModesPanel" styleClass="selectedScenarioEvaluationModesPanel"
					header="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EVALUATION_MODES_LABEL']}">
					<h:outputText id="evaluationModes"
						value="#{associateBean.selectedScenarioViewBean.evaluationModes}"
						escape="false" />
				</p:panel>

				<p:commandButton
					value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EDIT_EVALUATION_MODES_LABEL']}"
					icon="ui-icon-pencil"
					oncomplete="PF('dialogEditEvaluation').show()"
					update=":modifyEditEvaluationForm:dialogEditEvaluationId"
					process="@none" />
			</p:panel>
		</p:outputPanel>

	</ui:define>

	<ui:define name="customDialogOutFormWithoutForm">
		<h:form id="createScenarioForm">
			<p:dialog id="dialogCreateScenarioId"
				header="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.HEADER']}"
				widgetVar="dialogCreateScenario" modal="true" height="auto">
				<p:panelGrid columns="3">
					<h:outputLabel for="newScenarioName"
						value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newScenarioName" required="true"
						requiredMessage="#{msg['REQUIRED_FIELD']}" size="50"
						binding="#{input1}" />
					<p:message for="newScenarioName" display="text" />
					<h:outputLabel for="newScenarioObjective"
						value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.OBJECTIVE_LABEL']}" />
					<p:inputText id="newScenarioObjective" required="true"
						requiredMessage="#{msg['REQUIRED_FIELD']}" size="50"
						binding="#{input2}" />
					<p:message for="newScenarioObjective" display="text" />
				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{myScenariosController.onCreatePedagogicalScenario(input1.value, input2.value)}"
					update="@form :westForm:scenariosDataTable :contentForm :southForm"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { PF('dialogCreateScenario').hide(); }" />
			</p:dialog>
		</h:form>

		<h:form id="modifyScenarioForm">
			<p:dialog id="dialogEditScenarioId"
				header="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_SCENARIO_WINDOW.HEADER']}"
				widgetVar="dialogEditScenario" modal="true" height="auto">

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.NAME_LABEL']}"/></h3>
				<p:editor
					value="#{associateBean.selectedScenarioViewBean.name}" height="60"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo"/>

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.OBJECTIVE_LABEL']}"/></h3>
				<p:editor
					value="#{associateBean.selectedScenarioViewBean.objective}" height="250"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo"/>

				<p:commandButton styleClass="dialogValidationButton"
					value="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="false"
					action="#{associateBean.onSave()}"
					process="@form"
					update=":contentForm"
					oncomplete="PF('dialogEditScenario').hide();">
					<p:resetInput target=":modifyScenarioForm:dialogEditScenarioId" />
				</p:commandButton>
			</p:dialog>
		</h:form>

		<h:form id="modifyActivityForm">
			<p:dialog id="dialogEditActivityId"
				header="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.HEADER']}"
				widgetVar="dialogEditActivity" modal="true" height="auto">

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_NAME']}"/></h3>
				<p:editor value="#{associateBean.selectedPedagogicalActivityViewBean.name}" height="60"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo"/>

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_OBJECTIVE']}"/></h3>
				<p:editor
					value="#{associateBean.selectedPedagogicalActivityViewBean.objective}" height="120"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo" />

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_INSTRUCTIONS']}"/></h3>
				<p:editor value="#{associateBean.selectedPedagogicalActivityViewBean.instructions}" height="120"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo"/>

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_DURATION']}"/></h3>
				<p:editor value="#{associateBean.selectedPedagogicalActivityViewBean.duration}" height="60"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo"/>

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_TOOLS']}"/></h3>
				<p:pickList id="dialogAssociateToolCategoryPickList" height="80"
					value="#{associateBean.pickListBean.pickListEntities}"
					var="toolCategoryViewBean" itemValue="#{toolCategoryViewBean}"
					itemLabel="#{toolCategoryViewBean.name}" converter="PickListConverter"
					showSourceControls="false" showTargetControls="false"
					showCheckbox="true" showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains" addLabel="#{msg['PICKLIST.ADD_LABEL']}"
					addAllLabel="#{msg['PICKLIST.ADD_ALL_LABEL']}"
					removeLabel="#{msg['PICKLIST.REMOVE_LABEL']}"
					removeAllLabel="#{msg['PICKLIST.REMOVE_ALL_LABEL']}">
					<f:facet name="sourceCaption">#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.PICKLIST_TOOL_CATEGORIES_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.PICKLIST_TOOL_CATEGORIES_HEADER.ASSOCIATED']}</f:facet>
					<p:ajax event="transfer"
						listener="#{associateBean.onToolCategoryTransfer}"
						update="@this :contentForm:pedagogicalActivitiesDataTable :contentForm:messagesDisplayer"
						process="@this" />
				</p:pickList>

				<p:commandButton styleClass="dialogValidationButton"
					value="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="false"
					action="#{associateBean.onSaveSelectedPedagogicalActivity()}"
					process="@form"
					update=":modifyActivityForm:dialogEditActivityId :contentForm:pedagogicalActivitiesDataTable"
					oncomplete="PF('dialogEditActivity').hide();">
					<p:resetInput target=":modifyActivityForm:dialogEditActivityId" />
				</p:commandButton>
			</p:dialog>
		</h:form>

		<h:form id="modifyEditEvaluationForm">
			<p:dialog id="dialogEditEvaluationId"
				header="#{msg['MY_SCENARIOS.EDIT_EVALUATION_MODE_WINDOW.HEADER']}"
				widgetVar="dialogEditEvaluation" modal="true" height="auto">

				<h3 class="section-title"><p:outputLabel value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EVALUATION_MODES_LABEL']}"/></h3>
				<p:editor value="#{associateBean.selectedScenarioViewBean.evaluationModes}" height="400"
					controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo"/>

				<p:commandButton styleClass="dialogValidationButton"
					value="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="false"
					action="#{associateBean.onSave()}"
					process="@form"
					update=":contentForm:evaluationModes"
					oncomplete="PF('dialogEditEvaluation').hide();">
					<p:resetInput target=":modifyEditEvaluationForm:dialogEditEvaluationId" />
				</p:commandButton>
			</p:dialog>
		</h:form>

	</ui:define>

</ui:composition>