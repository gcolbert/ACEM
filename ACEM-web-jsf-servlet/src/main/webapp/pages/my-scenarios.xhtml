<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="../templates/template.xhtml">
	<ui:define name="content">
		<ui:debug hotkey="1"
			rendered="#{facesContext.application.projectStage == 'Development'}" />

		<h:form id="formScenarios">
			<p:growl id="messagesDisplayer" showDetail="true" />

			<p:confirmDialog global="true" styleClass="confirmDialog" showEffect="fade">
				<p:commandButton value="#{msg['CONFIRM_DIALOG.YES_LABEL']}"
					type="button" styleClass="ui-confirmdialog-yes"
					icon="ui-icon-check" />
				<p:commandButton value="#{msg['CONFIRM_DIALOG.NO_LABEL']}"
					type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
			</p:confirmDialog>

			<p:layout id="layout">

				<p:layoutUnit position="west" resizable="true" collapsible="true" header="#{msg['MY_SCENARIOS.HEADER']}" size="250">
					<p:panelGrid columns="1" styleClass="allScenariosPanel">
						<p:commandButton
							value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_LABEL']}"
							icon="ui-icon-plusthick" update=":dialogCreateScenarioId"
							oncomplete="PF('dialogCreateScenario').show()">
							<p:resetInput target=":dialogCreateScenarioId" />
						</p:commandButton>
						<p:scrollPanel mode="native" styleClass="allScenariosScrollPanel">
							<p:dataTable id="scenariosDataTable"
								emptyMessage="#{msg['MY_SCENARIOS.LIST.NO_RECORDS_FOUND']}"
								value="#{myScenariosController.scenarioViewBeans}"
								var="scenarioViewBean" rowKey="#{scenarioViewBean.id}"
								selection="#{myScenariosController.selectedScenarioViewBean}"
								selectionMode="single">
								<p:ajax event="rowSelect"
									listener="#{myScenariosController.onScenarioRowSelect}"
									update="@form" />
								<!-- 
								<p:ajax event="rowUnselect"
									listener="#{myScenariosController.onRowUnselect}"
									update="@form" />
									 -->
								<p:column styleClass="allScenariosScrollPanelColumn"
									headerText="#{msg['MY_SCENARIOS.LIST.COLUMN_HEADER']}">
									<h:outputText id="scenario" value="#{scenarioViewBean.name}" />
									<p:tooltip for="scenario" value="#{scenarioViewBean.objective}" />  
								</p:column>
							</p:dataTable>
						</p:scrollPanel>
						<p:commandButton id="deleteScenarioButton"
							value="#{msg['MY_SCENARIOS.DELETE_SCENARIO_LABEL']}"
							icon="ui-icon-trash"
							action="#{myScenariosController.deleteSelectedScenario}"
							disabled="#{myScenariosController.selectedScenarioViewBean == null}"
							update="@form">
							<p:confirm
								header="#{msg['MY_SCENARIOS.DELETE_SCENARIO.CONFIRMATION_HEADER']}"
								message="#{msg['MY_SCENARIOS.DELETE_SCENARIO.CONFIRMATION_QUESTION']}"
								icon="ui-icon-alert" />
						</p:commandButton>
					</p:panelGrid>
				</p:layoutUnit>

				<p:layoutUnit position="center" styleClass="selectedScenarioLayoutUnit">
					<p:panel header="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.HEADER']}"
						rendered="#{myScenariosController.selectedScenarioViewBean != null}">

						<p:panelGrid columns="2" styleClass="selectedScenarioPropertiesPanelGrid">
							<h:outputLabel for="selectedScenarioName"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.NAME_LABEL']}"
								styleClass="label" />
							<p:panel>
								<p:inplace styleClass="selectedScenarioPropertyInplace" editor="true">
									<p:ajax event="save" listener="#{myScenariosController.onSave}"
										update="@form" />
									<p:ajax event="cancel" update="@this" />
									<h:inputText id="selectedScenarioName"
										value="#{myScenariosController.selectedScenarioViewBean.name}"
										required="true" requiredMessage="#{msg['REQUIRED_FIELD']}" />
								</p:inplace>
							</p:panel>

							<h:outputLabel for="selectedScenarioObjective"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.OBJECTIVE_LABEL']}"
								styleClass="label" />
							<p:panel>
								<p:inplace styleClass="selectedScenarioPropertyInplace" editor="true">
									<p:ajax event="save" listener="#{myScenariosController.onSave}"
										update="@form" />
									<p:ajax event="cancel" update="@this" />
									<h:inputText id="selectedScenarioObjective"
										value="#{myScenariosController.selectedScenarioViewBean.objective}"
										required="true" requiredMessage="#{msg['REQUIRED_FIELD']}" />
								</p:inplace>
							</p:panel>

							<h:outputLabel for="selectedScenarioAuthors"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.AUTHORS_LABEL']}"
								styleClass="label" />
							<p:panel id="selectedScenarioAuthors">
								<h:outputText 
									value="#{myScenariosController.selectedScenarioViewBean.authors}" />
							</p:panel>
							<!-- 
							<p:panel id="selectedScenarioAuthors">
								<ui:repeat
									value="#{myScenariosController.selectedScenarioViewBean.authorViewBeans}"
									var="authorViewBean">
									<h:outputText value="#{authorViewBean.name}" />
								</ui:repeat>
							</p:panel>
							-->

							<h:outputLabel for="selectedScenarioCreationDate"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.CREATION_DATE_LABEL']}"
								styleClass="label" />
							<p:panel>
								<h:outputText id="selectedScenarioCreationDate"
									value="#{myScenariosController.selectedScenarioViewBean.creationDate}" />
							</p:panel>

							<h:outputLabel for="selectedScenarioModificationDate"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.MODIFICATION_DATE_LABEL']}"
								styleClass="label"
								rendered="#{myScenariosController.selectedScenarioViewBean.modificationDate != null}" />
							<p:panel
								rendered="#{myScenariosController.selectedScenarioViewBean.modificationDate != null}">
								<h:outputText id="selectedScenarioModificationDate"
									value="#{myScenariosController.selectedScenarioViewBean.modificationDate}" />
							</p:panel>

						</p:panelGrid>

						<p:dataTable styleClass="selectedScenarioActivitiesDataTable"
							editable="true"
							emptyMessage="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.NO_RECORDS_FOUND']}"
							value="#{myScenariosController.selectedScenarioViewBean.pedagogicalActivityViewBeans}"
							var="pedagogicalActivityViewBean"
							rowKey="pedagogicalActivityViewBean.id">

							<f:facet name="header">#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.TABLE_HEADER']}</f:facet>

							<p:ajax event="rowEdit"
								listener="#{myScenariosController.onActivityRowEdit}"
								update=":formScenarios:messagesDisplayer" />

							<p:ajax event="rowEditCancel" update="@this" />

							<p:column width="20"
								headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_POSITION_IN_SCENARIO']}">
								<h:outputText
									value="#{pedagogicalActivityViewBean.positionInScenario}" />
							</p:column>
							<p:column
								headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_NAME']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{pedagogicalActivityViewBean.name}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{pedagogicalActivityViewBean.name}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_OBJECTIVE']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{pedagogicalActivityViewBean.objective}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{pedagogicalActivityViewBean.objective}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_INSTRUCTIONS']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText
											value="#{pedagogicalActivityViewBean.instructions}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText
											value="#{pedagogicalActivityViewBean.instructions}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_DURATION']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{pedagogicalActivityViewBean.duration}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{pedagogicalActivityViewBean.duration}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column
								headerText="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.LIST.COLUMN_HEADER.ACTIVITY_TOOLS']}">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{pedagogicalActivityViewBean.resources}" />
									</f:facet>
									<f:facet name="input">
										<h:inputText value="#{pedagogicalActivityViewBean.resources}"
											style="width:100%" />
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column style="width:6%">
								<!-- 
								<p:commandButton 
									value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EDIT_PEDAGOGICAL_ACTIVITY_LABEL']}"
									icon="ui-icon-pencil"
									actionListener="#{myScenariosController.setCurrentPedagogicalActivityViewBean(pedagogicalActivityViewBean)}"
									action="#{myScenariosController.preparePicklistToolCategoryViewBeansForCurrentPedagogicalActivity()}"
									oncomplete="PF('dialogEditActivity').show()"
									update=":formEditActivity"
									process="@this" />
								 -->
								<p:rowEditor />
							</p:column>
						</p:dataTable>

						<p:commandButton
							value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.ADD_ACTIVITY_LABEL']}"
							icon="ui-icon-plusthick"
							action="#{myScenariosController.onCreateActivity}" update="@form" />

						<p:panel id="grid" header="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EVALUATION_MODES_LABEL']}">
							<p:editor id="evaluationModesEditor"
								value="#{myScenariosController.selectedScenarioViewBean.evaluationModes}"
								controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo" />
						</p:panel>

<!-- 
						<p:panelGrid columns="2">
							<h:outputLabel for="selectedScenarioName"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EVALUATION_MODES_LABEL']}"
								styleClass="label" />

							<h:outputLabel for="selectedScenarioName"
								value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.EVALUATION_MODES_LABEL']}"
								styleClass="label" />
							<p:editor id="evaluationModesEditor"
								value="#{myScenariosController.selectedScenarioViewBean.evaluationModes}"
								controls="bold italic underline strikethrough subscript superscript size style color bullets numbering undo redo" />
						</p:panelGrid>
-->						
						<p:commandButton icon="ui-icon-check" value="#{msg['MY_SCENARIOS.SELECTED_SCENARIO.SAVE_LABEL']}" action="#{myScenariosController.onSave}" update=":formScenarios:messagesDisplayer"/>
					</p:panel>
				</p:layoutUnit>
			</p:layout>
		</h:form>

		<p:dialog id="dialogCreateScenarioId"
			header="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.HEADER']}"
			widgetVar="dialogCreateScenario" modal="true" height="auto">
			<h:form id="formCreateScenario">
				<p:panelGrid columns="3">
					<h:outputLabel for="newScenarioName"
						value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.NAME_LABEL']}" />
					<p:inputText id="newScenarioName" required="true"
						requiredMessage="#{msg['REQUIRED_FIELD']}" size="50"
						binding="#{input1}" />
					<p:message for="newScenarioName" display="text" />

					<h:outputLabel for="newScenarioObjective"
						value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.OBJECTIVE_LABEL']}" />
					<p:inputText id="newScenarioObjective" required="true"
						requiredMessage="#{msg['REQUIRED_FIELD']}" size="50"
						binding="#{input2}" />
					<p:message for="newScenarioObjective" display="text" />

				</p:panelGrid>
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msg['MY_SCENARIOS.CREATE_SCENARIO_MODAL_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{myScenariosController.createScenario(input1.value, input2.value)}"
					update="@form :formScenarios"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogCreateScenario.hide(); }" />
			</h:form>
		</p:dialog>

		<p:dialog id="dialogEditActivityId"
			header="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.HEADER']}"
			widgetVar="dialogEditActivity" modal="true" height="auto">
			<h:form id="formEditActivity">
			<!-- 
				<p:pickList id="dialogAssociateToolCategoryPickList"
					value="#{myScenariosController.pickListBean.pickListEntities}"
					var="toolCategoryViewBean" itemValue="#{toolCategoryViewBean}"
					itemLabel="#{toolCategoryViewBean.name}" converter="PickListConverter"
					showSourceControls="false" showTargetControls="false"
					showCheckbox="true" showSourceFilter="true" showTargetFilter="true"
					filterMatchMode="contains" addLabel="#{msg['PICKLIST.ADD_LABEL']}"
					addAllLabel="#{msg['PICKLIST.ADD_ALL_LABEL']}"
					removeLabel="#{msg['PICKLIST.REMOVE_LABEL']}"
					removeAllLabel="#{msg['PICKLIST.REMOVE_ALL_LABEL']}">
					<f:facet name="sourceCaption">#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.PICKLIST_HEADER.AVAILABLE']}</f:facet>
					<f:facet name="targetCaption">#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.PICKLIST_HEADER.ASSOCIATED']}</f:facet>
					<p:ajax event="transfer"
						listener="#{myScenariosController.onToolCategoryTransfer}"
						update="@this :formOrganisations:tabViewOrganisations :formScenarios:messagesDisplayer"
						process="@this" />
				</p:pickList>
			 -->
				<p:commandButton styleClass="dialogValidationButton"
					value="#{msg['MY_SCENARIOS.EDIT_PEDAGOGICAL_ACTIVITY_WINDOW.VALIDATE']}"
					icon="ui-icon-check" validateClient="true"
					action="#{myScenariosController.onSavePedagogicalActivity()}"
					update="@form :formScenarios"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { dialogEditActivity.hide(); }" />
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>